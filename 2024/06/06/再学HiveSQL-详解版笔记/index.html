<!DOCTYPE html>
<html lang="en,zh-Hans">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="Hexo Theme Redefine">
    
    <meta name="author" content="Mr.zh">
    <!-- preconnect -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    
        
        
        
    
    <!--- Seo Part-->
    
    <link rel="canonical" href="http://example.com/2024/06/06/再学hivesql-详解版笔记/"/>
    <meta name="robots" content="index,follow">
    <meta name="googlebot" content="index,follow">
    <meta name="revisit-after" content="1 days">
    
        <meta name="description" content="Hive Sql 大全 本文基本涵盖了Hive日常使用的所有SQL，因为SQL太多，所以将SQL进行了如下分类： 一、DDL语句（数据定义语句）： 对数据库的操作：包含创建、修改数据库 对数据表的操作：分为内部表及外部表，分区表和分桶表 二、DQL语句（数据查询语句）： 单表查询、关联查询 hive函数：包含聚合函数，条件函数，日期函数，字符串函数等 行转列及列转行：lateral view 与">
<meta property="og:type" content="article">
<meta property="og:title" content="再学HiveSQL-详解版笔记">
<meta property="og:url" content="http://example.com/2024/06/06/%E5%86%8D%E5%AD%A6HiveSQL-%E8%AF%A6%E8%A7%A3%E7%89%88%E7%AC%94%E8%AE%B0/index.html">
<meta property="og:site_name" content="小贺的博客">
<meta property="og:description" content="Hive Sql 大全 本文基本涵盖了Hive日常使用的所有SQL，因为SQL太多，所以将SQL进行了如下分类： 一、DDL语句（数据定义语句）： 对数据库的操作：包含创建、修改数据库 对数据表的操作：分为内部表及外部表，分区表和分桶表 二、DQL语句（数据查询语句）： 单表查询、关联查询 hive函数：包含聚合函数，条件函数，日期函数，字符串函数等 行转列及列转行：lateral view 与">
<meta property="og:locale">
<meta property="article:published_time" content="2024-06-06T08:24:44.000Z">
<meta property="article:modified_time" content="2024-06-06T08:42:28.523Z">
<meta property="article:author" content="Mr.zh">
<meta property="article:tag" content="大数据技术">
<meta property="article:tag" content="SQL">
<meta property="article:tag" content="Hive SQL">
<meta name="twitter:card" content="summary">
    
    
    <!--- Icon Part-->
    <link rel="icon" type="image/png" href="/images/redefine-favicon.svg" sizes="192x192">
    <link rel="apple-touch-icon" sizes="180x180" href="/images/redefine-favicon.svg">
    <meta name="theme-color" content="#A31F34">
    <link rel="shortcut icon" href="/images/redefine-favicon.svg">
    <!--- Page Info-->
    
    <title>
        
            再学HiveSQL-详解版笔记 -
        
        Mr.z博客
    </title>

    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fonts/Chillax/chillax.css">

    <!--- Inject Part-->
    

    
        <style>
    :root {
        --preloader-background-color: #fff;
        --preloader-text-color: #000;
    }

    @media (prefers-color-scheme: dark) {
        :root {
            --preloader-background-color: #202124;
            --preloader-text-color: #fff;
        }
    }

    @media (prefers-color-scheme: light) {
        :root {
            --preloader-background-color: #fff;
            --preloader-text-color: #000;
        }
    }

    @media (max-width: 600px) {
        .ml13 {
            font-size: 2.6rem !important; /* Adjust this value as needed */
        }
    }

    .preloader {
        display: flex;
        flex-direction: column;
        gap: 1rem; /* Tailwind 'gap-4' is 1rem */
        align-items: center;
        justify-content: center;
        position: fixed;
        padding: 12px;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        width: 100vw;
        height: 100vh; /* 'h-screen' is 100% of the viewport height */
        background-color: var(--preloader-background-color);
        z-index: 1100; /* 'z-[1100]' sets the z-index */
        transition: opacity 0.2s ease-in-out;
    }

    .ml13 {
        font-size: 3.2rem;
        /* text-transform: uppercase; */
        color: var(--preloader-text-color);
        letter-spacing: -1px;
        font-weight: 500;
        font-family: 'Chillax-Variable', sans-serif;
        text-align: center;
    }

    .ml13 .word {
        display: inline-flex;
        flex-wrap: wrap;
        white-space: nowrap;
    }

    .ml13 .letter {
        display: inline-block;
        line-height: 1em;
    }
</style>

<div class="preloader">
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/anime.min.js"></script>
    <h1 class="ml13">
        Mr.z博客
    </h1>
    <script>
        var textWrapper = document.querySelector('.ml13');
        // Split text into words
        var words = textWrapper.textContent.trim().split(' ');

        // Clear the existing content
        textWrapper.innerHTML = '';

        // Wrap each word and its letters in spans
        words.forEach(function(word) {
            var wordSpan = document.createElement('span');
            wordSpan.classList.add('word');
            wordSpan.innerHTML = word.replace(/\S/g, "<span class='letter'>$&</span>");
            textWrapper.appendChild(wordSpan);
            textWrapper.appendChild(document.createTextNode(' ')); // Add space between words
        });


        anime.timeline({loop: true})
            .add({
                targets: '.ml13 .letter',
                translateY: [100,0],
                translateZ: 0,
                opacity: [0,1],
                easing: "easeOutExpo",
                duration: 1400,
                delay: (el, i) => 300 + 30 * i
            }).add({
            targets: '.ml13 .letter',
            translateY: [0,-100],
            opacity: [1,0],
            easing: "easeInExpo",
            duration: 1200,
            delay: (el, i) => 100 + 30 * i
        });

        let themeStatus = JSON.parse(localStorage.getItem('REDEFINE-THEME-STATUS'))?.isDark;

        // If the theme status is not found in local storage, check the preferred color scheme
        if (themeStatus === undefined || themeStatus === null) {
            if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
                themeStatus = 'dark';
            } else {
                themeStatus = 'light';
            }
        }

        // Now you can use the themeStatus variable in your code
        if (themeStatus) {
            document.documentElement.style.setProperty('--preloader-background-color', '#202124');
            document.documentElement.style.setProperty('--preloader-text-color', '#fff');
        } else {
            document.documentElement.style.setProperty('--preloader-background-color', '#fff');
            document.documentElement.style.setProperty('--preloader-text-color', '#000');
        }

        window.addEventListener('load', function () {
            hidePreloaderAfterTimeout(1000); // Hide after 1000 milliseconds once the window has loaded
        });

        // Backup failsafe: Hide preloader after a maximum of 5000 milliseconds, regardless of the window load event
        hidePreloaderAfterTimeout(5000);

        function hidePreloaderAfterTimeout(delay) {
            setTimeout(function () {
                var preloader = document.querySelector('.preloader');
                preloader.style.opacity = '0';
                setTimeout(function () {
                    preloader.style.display = 'none';
                }, 200);
            }, delay);
        }
    </script>
</div>
    

    
<link rel="stylesheet" href="/css/style.css">


    
        <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/assets/build/styles.css">
    

    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fonts/fonts.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fonts/Satoshi/satoshi.css">
    <!--- Font Part-->
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    
    
    
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap# Font URL to CSS file" rel="stylesheet">
    
    
        <link href="https://fonts.googleapis.com/css2?family=Farsan&display=swap" rel="stylesheet">
    


    <script id="hexo-configurations">
    window.config = {"hostname":"example.com","root":"/","language":"en,zh-Hans","path":"search.xml"};
    window.theme = {"articles":{"style":{"font_size":"16px","line_height":1.5,"image_border_radius":"14px","image_alignment":"center","image_caption":false,"link_icon":true,"title_alignment":"left","headings_top_spacing":{"h1":"5rem","h2":"4rem","h3":"2.8rem","h4":"2.5rem","h5":"2.2rem","h6":"2rem"}},"word_count":{"enable":true,"count":true,"min2read":true},"author_label":{"enable":true,"auto":false,"list":["Lv1","Lv2","Lv3"]},"code_block":{"copy":true,"style":"mac","font":{"enable":false,"family":null,"url":null}},"toc":{"enable":true,"max_depth":3,"number":false,"expand":true,"init_open":true},"copyright":{"enable":true,"default":"cc_by_nc_sa"},"lazyload":true,"recommendation":{"enable":false,"title":"推荐阅读","limit":3,"mobile_limit":2,"placeholder":"/images/wallhaven-wqery6-light.webp","skip_dirs":["/docs/","/private/"]}},"colors":{"primary":"#A31F34","secondary":null,"default_mode":"light"},"global":{"fonts":{"chinese":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap# Font URL to CSS file"},"english":{"enable":true,"family":"Farsan","url":"https://fonts.googleapis.com/css2?family=Farsan&display=swap"}},"content_max_width":"1000px","sidebar_width":"210px","hover":{"shadow":true,"scale":true},"scroll_progress":{"bar":true,"percentage":true},"website_counter":{"url":"https://cn.vercount.one/js","enable":true,"site_pv":true,"site_uv":true,"post_pv":true},"single_page":true,"preloader":true,"open_graph":true,"google_analytics":{"enable":false,"id":null}},"home_banner":{"enable":true,"style":"fixed","image":{"light":"/images/wallhaven-wqery6-light.webp","dark":"/images/wallhaven-wqery6-dark.webp"},"title":"小贺的博客","subtitle":{"text":["Loading..."],"hitokoto":{"enable":true,"api":"https://v1.hitokoto.cn"},"typing_speed":100,"backing_speed":80,"starting_delay":500,"backing_delay":1500,"loop":true,"smart_backspace":true},"text_color":{"light":"#fff","dark":"#d1d1b6"},"text_style":{"title_size":"2.8rem","subtitle_size":"1.5rem","line_height":1.2},"custom_font":{"enable":true,"family":"Noto Sans SC","url":"https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700&display=swap"},"social_links":{"enable":false,"style":"default","links":{"github":"https://github.com/zhyoulove","instagram":"https://instagram.com# your Instagram URL","zhihu":"https://www.zhihu.com/people/hu-ge-74-63-86","twitter":"https://twitter.com","email":"1173119892@qq.com"},"qrs":{"weixin":null}}},"plugins":{"feed":{"enable":false},"aplayer":{"enable":true,"type":"fixed","audios":[{"name":"Something Just Like This","artist":"Coldplay","url":"https://evan.beee.top/music/Something%20Just%20Like%20This%20-%20The%20Chainsmokers%E3%80%81Coldplay.mp3","cover":"https://evan.beee.top/music/covers/Something_Just_Like_This.png"},{"name":"Imagine# audio name","artist":"John Lennon# audio artist","url":"https://evan.beee.top/music/Imagine%20-%20John%20Lennon.mp3# audio url","cover":"https://evan.beee.top/music/covers/Lennon_Imagine_Sleeve_1975.jpg","lrc":null}]},"mermaid":{"enable":false,"version":"9.3.0"}},"version":"2.6.1","navbar":{"auto_hide":false,"color":{"left":"#f78736","right":"#367df7","transparency":35},"width":{"home":"1200px","pages":"1000px"},"links":{"首页":{"path":"/","icon":"fa-regular fa-house"},"关于":{"icon":"fa-regular fa-user","submenus":{"我":"/about/","GitHub":"https://github.com/zhyoulove"}},"分类":{"icon":"fa-solid fa-folder","path":"/categories/"},"相册":{"icon":"fa-solid fa-image","path":"/masonry/"},"Lovely":{"icon":"fa-solid fa-heart","submenus":{"力扣":"https://leetcode.cn/u/song-vv/","知乎":"https://www.zhihu.com/people/hu-ge-74-63-86","华为云":"https://developer.huaweicloud.com/usercenter/mycommunity/dynamics","CSDN":"https://blog.csdn.net/zh_19995?spm=1010.2135.3001.5343"}}},"search":{"enable":true,"preload":true}},"page_templates":{"friends_column":2,"tags_style":"blur"},"home":{"sidebar":{"enable":true,"position":"left","first_item":"menu","announcement":null,"show_on_mobile":true,"links":{"文章列表":{"path":"/archives","icon":"fa-regular fa-archive"},"文章分类":{"path":"/categories","icon":"fa-regular fa-folder"},"文章标签":{"path":"/tags","icon":"fa-regular fa-tags"},"关于Me":{"path":"/about/","icon":"fa-regular fa-folder"}}},"article_date_format":"YYYY-MM-DD HH:mm:ss","categories":{"enable":true,"limit":3},"tags":{"enable":true,"limit":3}},"footerStart":"2022/8/17 11:45:14"};
    window.lang_ago = {"second":"%s seconds ago","minute":"%s minutes ago","hour":"%s hours ago","day":"%s days ago","week":"%s weeks ago","month":"%s months ago","year":"%s years ago"};
    window.data = {"masonry":true};
  </script>
    
    <!--- Fontawesome Part-->
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fontawesome/fontawesome.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fontawesome/brands.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fontawesome/solid.min.css">
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/fontawesome/regular.min.css">
    
    
    
    
<meta name="generator" content="Hexo 7.1.1"></head>


<body>
<div class="progress-bar-container">
    
        <span class="scroll-progress-bar"></span>
    

    
        <span class="pjax-progress-bar"></span>
<!--        <span class="swup-progress-icon">-->
<!--            <i class="fa-solid fa-circle-notch fa-spin"></i>-->
<!--        </span>-->
    
</div>


<main class="page-container" id="swup">

    

    <div class="main-content-container">


        <div class="main-content-header">
            <header class="navbar-container px-6 md:px-12">

    <div class="navbar-content ">
        <div class="left">
            
            <a class="logo-title" href="/">
                
                Mr.z博客
                
            </a>
        </div>

        <div class="right">
            <!-- PC -->
            <div class="desktop">
                <ul class="navbar-list">
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/"
                                        >
                                    <i class="fa-regular fa-house fa-fw"></i>
                                    首页
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-regular fa-user fa-fw"></i>
                                    关于
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a href="/about/">
                                                    我
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://github.com/zhyoulove">
                                                    GITHUB
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/categories/"
                                        >
                                    <i class="fa-solid fa-folder fa-fw"></i>
                                    分类
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class=""
                                   href="/masonry/"
                                        >
                                    <i class="fa-solid fa-image fa-fw"></i>
                                    相册
                                    
                                </a>

                                <!-- Submenu -->
                                
                            </li>
                    
                        
                            

                            <li class="navbar-item">
                                <!-- Menu -->
                                <a class="has-dropdown"
                                   href="#"
                                        onClick=&#34;return false;&#34;>
                                    <i class="fa-solid fa-heart fa-fw"></i>
                                    LOVELY
                                    <i class="fa-solid fa-chevron-down fa-fw"></i>
                                </a>

                                <!-- Submenu -->
                                
                                    <ul class="sub-menu">
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://leetcode.cn/u/song-vv/">
                                                    力扣
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://www.zhihu.com/people/hu-ge-74-63-86">
                                                    知乎
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://developer.huaweicloud.com/usercenter/mycommunity/dynamics">
                                                    华为云
                                                </a>
                                            </li>
                                        
                                            <li>
                                                <a target="_blank" rel="noopener" href="https://blog.csdn.net/zh_19995?spm=1010.2135.3001.5343">
                                                    CSDN
                                                </a>
                                            </li>
                                        
                                    </ul>
                                
                            </li>
                    
                    
                        <li class="navbar-item search search-popup-trigger">
                            <i class="fa-solid fa-magnifying-glass"></i>
                        </li>
                    
                </ul>
            </div>
            <!-- Mobile -->
            <div class="mobile">
                
                    <div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                
                <div class="icon-item navbar-bar">
                    <div class="navbar-bar-middle"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Mobile sheet -->
    <div class="navbar-drawer h-screen w-full absolute top-0 left-0 bg-background-color flex flex-col justify-between">
        <ul class="drawer-navbar-list flex flex-col px-4 justify-center items-start">
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/"
                        >
                            <span>
                                首页
                            </span>
                            
                                <i class="fa-regular fa-house fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-关于"
                        >
                            <span>
                                关于
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-关于">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           href="/about/">我</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://github.com/zhyoulove">GITHUB</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/categories/"
                        >
                            <span>
                                分类
                            </span>
                            
                                <i class="fa-solid fa-folder fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                           href="/masonry/"
                        >
                            <span>
                                相册
                            </span>
                            
                                <i class="fa-solid fa-image fa-sm fa-fw"></i>
                            
                        </a>
                        

                        
                    </li>
            
                
                    

                    <li class="drawer-navbar-item-sub text-base my-1.5 flex flex-col w-full">
                        
                        <div class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary cursor-pointer text-2xl font-semibold group border-b border-border-color hover:border-primary w-full "
                             navbar-data-toggle="submenu-Lovely"
                        >
                            <span>
                                LOVELY
                            </span>
                            
                                <i class="fa-solid fa-chevron-right fa-sm fa-fw transition-all"></i>
                            
                        </div>
                        

                        
                            <div class="flex-col items-start px-2 py-2 hidden" data-target="submenu-Lovely">
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://leetcode.cn/u/song-vv/">力扣</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://www.zhihu.com/people/hu-ge-74-63-86">知乎</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://developer.huaweicloud.com/usercenter/mycommunity/dynamics">华为云</a>
                                    </div>
                                
                                    <div class="drawer-navbar-item text-base flex flex-col justify-center items-start hover:underline active:underline hover:underline-offset-1 rounded-3xl">
                                        <a class=" text-third-text-color text-xl"
                                           target="_blank" rel="noopener" href="https://blog.csdn.net/zh_19995?spm=1010.2135.3001.5343">CSDN</a>
                                    </div>
                                
                            </div>
                        
                    </li>
            

            
            
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/archives"
                        >
                            <span>文章列表</span>
                            <i class="fa-regular fa-archive fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/categories"
                        >
                            <span>文章分类</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/tags"
                        >
                            <span>文章标签</span>
                            <i class="fa-regular fa-tags fa-sm fa-fw"></i>
                        </a>
                    </li>
                
                    
                    <li class="drawer-navbar-item text-base my-1.5 flex flex-col w-full">
                        <a class="py-1.5 px-2 flex flex-row items-center justify-between gap-1 hover:!text-primary active:!text-primary text-2xl font-semibold group border-b border-border-color hover:border-primary w-full active"
                           href="/about/"
                        >
                            <span>关于Me</span>
                            <i class="fa-regular fa-folder fa-sm fa-fw"></i>
                        </a>
                    </li>
                
            
        </ul>

        <div class="statistics flex justify-around my-2.5">
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/tags">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">35</div>
        <div class="label text-third-text-color text-sm">標籤</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/categories">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">13</div>
        <div class="label text-third-text-color text-sm">分類</div>
    </a>
    <a class="item tag-count-item flex flex-col justify-center items-center w-20" href="/archives">
        <div class="number text-2xl sm:text-xl text-second-text-color font-semibold">24</div>
        <div class="label text-third-text-color text-sm">文章</div>
    </a>
</div>
    </div>

    <div class="window-mask"></div>

</header>


        </div>

        <div class="main-content-body">

            

            <div class="main-content">

                
                    <div class="post-page-container flex relative justify-between box-border w-full h-full">
    <div class="article-content-container">

        <div class="article-title relative w-full">
            
                <div class="w-full flex items-center pt-6 justify-start">
                    <h1 class="article-title-regular text-second-text-color text-4xl md:text-6xl font-bold px-2 sm:px-6 md:px-8 py-3">再学HiveSQL-详解版笔记</h1>
                </div>
            
            </div>

        
            <div class="article-header flex flex-row gap-2 items-center px-2 sm:px-6 md:px-8">
                <div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]">
                    <img src="/images/redefine-avatar.svg">
                </div>
                <div class="info flex flex-col justify-between">
                    <div class="author flex items-center">
                        <span class="name text-default-text-color text-lg font-semibold">Mr.zh</span>
                        
                            <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv3</span>
                        
                    </div>
                    <div class="meta-info">
                        <div class="article-meta-info">
    <span class="article-date article-meta-item">
        <i class="fa-regular fa-pen-fancy"></i>&nbsp;
        <span class="desktop">2024-06-06 16:24:44</span>
        <span class="mobile">2024-06-06 16:24:44</span>
        <span class="hover-info">撰寫</span>
    </span>
    
        <span class="article-date article-meta-item">
            <i class="fa-regular fa-wrench"></i>&nbsp;
            <span class="desktop">2024-06-06 16:42:28</span>
            <span class="mobile">2024-06-06 16:42:28</span>
            <span class="hover-info">更新</span>
        </span>
    

    
        <span class="article-categories article-meta-item">
            <i class="fa-regular fa-folders"></i>&nbsp;
            <ul>
                
                
                    
                        
                        <li>
                            <a href="/categories/%E5%A4%A7%E6%95%B0%E6%8D%AE/">大数据</a>&nbsp;
                        </li>
                    
                    
                
            </ul>
        </span>
    
    
        <span class="article-tags article-meta-item">
            <i class="fa-regular fa-tags"></i>&nbsp;
            <ul>
                
                    <li>
                        <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/">大数据技术</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/SQL/">SQL</a>&nbsp;
                    </li>
                
                    <li>
                        | <a href="/tags/Hive-SQL/">Hive SQL</a>&nbsp;
                    </li>
                
            </ul>
        </span>
    

    
    
        <span class="article-wordcount article-meta-item">
            <i class="fa-regular fa-typewriter"></i>&nbsp;<span>13.2k 字數</span>
        </span>
    
    
        <span class="article-min2read article-meta-item">
            <i class="fa-regular fa-clock"></i>&nbsp;<span>60 分鐘</span>
        </span>
    
    
        <span class="article-pv article-meta-item">
            <i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span>
        </span>
    
</div>

                    </div>
                </div>
            </div>
        

        


        <div class="article-content markdown-body px-2 sm:px-6 md:px-8 pb-8">
            <h1 id="Hive-Sql-大全"><a href="#Hive-Sql-大全" class="headerlink" title="Hive Sql 大全"></a>Hive Sql 大全</h1><blockquote>
<p>本文基本涵盖了Hive日常使用的所有SQL，因为SQL太多，所以将SQL进行了如下分类： 一、DDL语句（数据定义语句）：<br> 对数据库的操作：包含创建、修改数据库<br> 对数据表的操作：分为内部表及外部表，分区表和分桶表<br> 二、DQL语句（数据查询语句）：<br> 单表查询、关联查询<br> hive函数：包含聚合函数，条件函数，日期函数，字符串函数等<br> 行转列及列转行：lateral view 与 explode 以及 reflect<br> 窗口函数与分析函数<br> 其他一些窗口函数</p>
</blockquote>
<h2 id="hive的DDL语法"><a href="#hive的DDL语法" class="headerlink" title="hive的DDL语法"></a>hive的DDL语法</h2><h3 id="对数据库的操作"><a href="#对数据库的操作" class="headerlink" title="对数据库的操作"></a>对数据库的操作</h3><ul>
<li>创建数据库:</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> database if <span class="keyword">not</span> <span class="keyword">exists</span> myhive;</span><br><span class="line"># 说明：hive的表存放位置模式是由hive<span class="operator">-</span>site.xml当中的一个属性指定的</span><br><span class="line"># hive.metastore.warehouse.dir</span><br><span class="line"></span><br><span class="line"># 创建数据库并指定hdfs存储位置:</span><br><span class="line"><span class="keyword">create</span> database myhive2 location <span class="string">&#x27;/myhive2&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>修改数据库:</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span>  database  myhive2  <span class="keyword">set</span>  dbproperties(<span class="string">&#x27;createtime&#x27;</span><span class="operator">=</span><span class="string">&#x27;20210329&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>说明：可以使用alter  database 命令来修改数据库的一些属性。但是数据库的元数据信息是不可更改的，包括数据库的名称以及数据库所在的位置</p>
</blockquote>
<ul>
<li>查看数据库详细信息</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#查看数据库基本信息</span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">desc</span>  database  myhive2;</span><br><span class="line"></span><br><span class="line"># 查看数据库更多详细信息</span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">desc</span> database extended  myhive2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>删除数据库</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 删除一个空数据库，如果数据库下面有数据表，那么就会报错</span><br><span class="line"><span class="keyword">drop</span>  database  myhive2;</span><br><span class="line"></span><br><span class="line"># 强制删除数据库，包含数据库下面的表一起删除</span><br><span class="line"><span class="keyword">drop</span>  database  myhive  cascade; </span><br></pre></td></tr></table></figure></div>

<h3 id="对数据表的操作"><a href="#对数据表的操作" class="headerlink" title="对数据表的操作"></a>对数据表的操作</h3><h4 id="对管理表-内部表-的操作"><a href="#对管理表-内部表-的操作" class="headerlink" title="对管理表(内部表)的操作:"></a>对管理表(内部表)的操作:</h4><ul>
<li>建内部表:</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">hive (myhive)<span class="operator">&gt;</span> use myhive; <span class="comment">-- 使用myhive数据库</span></span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> stu(id <span class="type">int</span>,name string);</span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span> (<span class="number">1</span>,&quot;zhangsan&quot;);</span><br><span class="line"> <span class="comment">-- 一次插入多条数据</span></span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">insert</span> <span class="keyword">into</span> stu <span class="keyword">values</span> (<span class="number">1</span>,&quot;zhangsan&quot;),(<span class="number">2</span>,&quot;lisi&quot;); </span><br><span class="line">hive (myhive)<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> stu;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>hive建表时候的字段类型:</li>
</ul>
<table>
<thead>
<tr>
<th><strong>分类</strong></th>
<th><strong>类型</strong></th>
<th><strong>描述</strong></th>
<th><strong>字面量示例</strong></th>
</tr>
</thead>
<tbody><tr>
<td>原始类型</td>
<td>BOOLEAN</td>
<td>true&#x2F;false</td>
<td>TRUE</td>
</tr>
<tr>
<td></td>
<td>TINYINT</td>
<td>1字节的有符号整数 -128~127</td>
<td>1Y</td>
</tr>
<tr>
<td></td>
<td>SMALLINT</td>
<td>2个字节的有符号整数，-32768~32767</td>
<td>1S</td>
</tr>
<tr>
<td></td>
<td><strong>INT</strong></td>
<td>4个字节的带符号整数</td>
<td>1</td>
</tr>
<tr>
<td></td>
<td>BIGINT</td>
<td>8字节带符号整数</td>
<td>1L</td>
</tr>
<tr>
<td></td>
<td>FLOAT</td>
<td>4字节单精度浮点数1.0</td>
<td></td>
</tr>
<tr>
<td></td>
<td>DOUBLE</td>
<td>8字节双精度浮点数</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td>DEICIMAL</td>
<td>任意精度的带符号小数</td>
<td>1.0</td>
</tr>
<tr>
<td></td>
<td><strong>STRING</strong></td>
<td>字符串，变长</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>VARCHAR</td>
<td>变长字符串</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>CHAR</td>
<td>固定长度字符串</td>
<td>“a”,’b’</td>
</tr>
<tr>
<td></td>
<td>BINARY</td>
<td>字节数组</td>
<td>无法表示</td>
</tr>
<tr>
<td></td>
<td>TIMESTAMP</td>
<td>时间戳，毫秒值精度</td>
<td>122327493795</td>
</tr>
<tr>
<td></td>
<td><strong>DATE</strong></td>
<td>日期</td>
<td>‘2016-03-29’</td>
</tr>
<tr>
<td></td>
<td>INTERVAL</td>
<td>时间频率间隔</td>
<td></td>
</tr>
<tr>
<td>复杂类型</td>
<td>ARRAY</td>
<td>有序的的同类型的集合</td>
<td>array(1,2)</td>
</tr>
<tr>
<td></td>
<td>MAP</td>
<td>key-value,key必须为原始类型，value可以任意类型</td>
<td>map(‘a’,1,’b’,2)</td>
</tr>
<tr>
<td></td>
<td>STRUCT</td>
<td>字段集合,类型可以不同</td>
<td>struct(‘1’,1,1.0), named_stract(‘col1’,’1’,’col2’,1,’clo3’,1.0)</td>
</tr>
<tr>
<td></td>
<td>UNION</td>
<td>在有限取值范围内的一个值</td>
<td>create_union(1,’a’,63)</td>
</tr>
</tbody></table>
<blockquote>
<p><strong>对decimal类型简单解释下</strong>：<br> 用法：decimal(11,2) 代表最多有11位数字，其中后2位是小数，整数部分是9位；如果整数部分超过9位，则这个字段就会变成null；如果小数部分不足2位，则后面用0补齐两位，如果小数部分超过两位，则超出部分四舍五入<br> 也可直接写 decimal，后面不指定位数，默认是 decimal(10,0)  整数10位，没有小数</p>
</blockquote>
<ul>
<li>创建表并指定字段之间的分隔符</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span>  <span class="keyword">table</span> if <span class="keyword">not</span> <span class="keyword">exists</span> stu2(id <span class="type">int</span> ,name string) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> stored <span class="keyword">as</span> textfile location <span class="string">&#x27;/user/stu2&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>row format delimited fields terminated by ‘\t’  指定字段分隔符，默认分隔符为 ‘\001’<br> stored as 指定存储格式<br> location 指定存储位置</p>
</blockquote>
<ul>
<li>根据查询结果创建表</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu3 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> stu2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>根据已经存在的表结构创建表</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> stu4 <span class="keyword">like</span> stu2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查询表的结构</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 只查询表内字段及属性</span><br><span class="line"><span class="keyword">desc</span> stu2;</span><br><span class="line"></span><br><span class="line"># 详细查询</span><br><span class="line"><span class="keyword">desc</span> formatted  stu2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查询创建表的语句</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> <span class="keyword">create</span> <span class="keyword">table</span> stu2;</span><br></pre></td></tr></table></figure></div>

<h4 id="对外部表操作"><a href="#对外部表操作" class="headerlink" title="对外部表操作"></a>对外部表操作</h4><blockquote>
<p>外部表因为是指定其他的hdfs路径的数据加载到表当中来，所以hive表会认为自己不完全独占这份数据，所以删除hive表的时候，数据仍然存放在hdfs当中，不会删掉，只会删除表的元数据</p>
</blockquote>
<ul>
<li>构建外部表</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> student (s_id string,s_name string) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>从本地文件系统向表中加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 追加操作</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/student.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> student;</span><br><span class="line"></span><br><span class="line"># 覆盖操作</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/student.csv&#x27;</span> overwrite  <span class="keyword">into</span> <span class="keyword">table</span> student;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>从hdfs文件系统向表中加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> load data inpath <span class="string">&#x27;/hivedatas/techer.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> techer;</span><br><span class="line"></span><br><span class="line"># 加载数据到指定分区</span><br><span class="line">load data inpath <span class="string">&#x27;/hivedatas/techer.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> techer <span class="keyword">partition</span>(cur_date<span class="operator">=</span><span class="number">20201210</span>);</span><br></pre></td></tr></table></figure></div>

<blockquote>
<ul>
<li><strong>注意</strong>：<br> 1.使用 load data local 表示从本地文件系统加载，文件会拷贝到hdfs上<br> 2.使用 load data 表示从hdfs文件系统加载，文件会直接移动到hive相关目录下，注意不是拷贝过去，因为hive认为hdfs文件已经有3副本了，没必要再次拷贝了<br> 3.如果表是分区表，load 时不指定分区会报错<br> 4.如果加载相同文件名的文件，会被自动重命名</li>
</ul>
</blockquote>
<h4 id="对分区表的操作"><a href="#对分区表的操作" class="headerlink" title="对分区表的操作"></a>对分区表的操作</h4><ul>
<li>创建分区表的语法</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score(s_id string, s_score <span class="type">int</span>) partitioned <span class="keyword">by</span> (<span class="keyword">month</span> string);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>创建一个表带多个分区</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score2 (s_id string, s_score <span class="type">int</span>) partitioned <span class="keyword">by</span> (<span class="keyword">year</span> string,<span class="keyword">month</span> string,<span class="keyword">day</span> string);</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong>注意：<br> hive表创建的时候可以用 location 指定一个文件或者文件夹，当指定文件夹时，hive会加载文件夹下的所有文件，当表中无分区时，这个文件夹下不能再有文件夹，否则报错<br> 当表是分区表时，比如 partitioned by (day string)， 则这个文件夹下的每一个文件夹就是一个分区，且文件夹名为 day&#x3D;20201123 这种格式，然后使用：msck  repair   table  score; 修复表结构，成功之后即可看到数据已经全部加载到表当中去了</strong></p>
</blockquote>
<ul>
<li>加载数据到一个分区的表中</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span> (<span class="keyword">month</span><span class="operator">=</span><span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>加载数据到一个多分区的表中去</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> score2 <span class="keyword">partition</span>(<span class="keyword">year</span><span class="operator">=</span><span class="string">&#x27;2018&#x27;</span>,<span class="keyword">month</span><span class="operator">=</span><span class="string">&#x27;06&#x27;</span>,<span class="keyword">day</span><span class="operator">=</span><span class="string">&#x27;01&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查看分区</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span>  partitions  score;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>添加一个分区</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="keyword">month</span><span class="operator">=</span><span class="string">&#x27;201805&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>同时添加多个分区</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">add</span> <span class="keyword">partition</span>(<span class="keyword">month</span><span class="operator">=</span><span class="string">&#x27;201804&#x27;</span>) <span class="keyword">partition</span>(<span class="keyword">month</span> <span class="operator">=</span> <span class="string">&#x27;201803&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：添加分区之后就可以在hdfs文件系统当中看到表下面多了一个文件夹</p>
</blockquote>
<ul>
<li>删除分区</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score <span class="keyword">drop</span> <span class="keyword">partition</span>(<span class="keyword">month</span> <span class="operator">=</span> <span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<h4 id="对分桶表操作"><a href="#对分桶表操作" class="headerlink" title="对分桶表操作"></a>对分桶表操作</h4><blockquote>
<p>将数据按照指定的字段进行分成多个桶中去，就是按照分桶字段进行哈希划分到多个文件当中去<br> 分区就是分文件夹，分桶就是分文件</p>
</blockquote>
<blockquote>
<p>分桶优点：<br> \1. 提高join查询效率<br> \2. 提高抽样效率</p>
</blockquote>
<ul>
<li>开启hive的捅表功能</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> hive.enforce.bucketing<span class="operator">=</span><span class="literal">true</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>设置reduce的个数</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">set</span> mapreduce.job.reduces<span class="operator">=</span><span class="number">3</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>创建桶表</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> course (c_id string,c_name string) clustered <span class="keyword">by</span>(c_id) <span class="keyword">into</span> <span class="number">3</span> buckets;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>桶表的数据加载：由于桶表的数据加载通过hdfs  dfs  -put文件或者通过load  data均不可以，只能通过insert  overwrite 进行加载<br> 所以把文件加载到桶表中，需要先创建普通表，并通过insert  overwrite的方式将普通表的数据通过查询的方式加载到桶表当中去</p>
</blockquote>
<ul>
<li>通过insert  overwrite给桶表中加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> course <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> course_common cluster <span class="keyword">by</span>(c_id);  <span class="comment">-- 最后指定桶字段</span></span><br></pre></td></tr></table></figure></div>

<h4 id="修改表和删除表"><a href="#修改表和删除表" class="headerlink" title="修改表和删除表"></a>修改表和删除表</h4><ul>
<li>修改表名称</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">alter</span>  <span class="keyword">table</span>  old_table_name  rename  <span class="keyword">to</span>  new_table_name;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>增加&#x2F;修改列信息</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查询表结构</span><br><span class="line"><span class="keyword">desc</span> score5;</span><br><span class="line"></span><br><span class="line"># 添加列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score5 <span class="keyword">add</span> columns (mycol string, mysco string);</span><br><span class="line"></span><br><span class="line"># 更新列</span><br><span class="line"><span class="keyword">alter</span> <span class="keyword">table</span> score5 change <span class="keyword">column</span> mysco mysconew <span class="type">int</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>删除表操作</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">drop</span> <span class="keyword">table</span> score5;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>清空表操作</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">truncate</span> <span class="keyword">table</span> score6;</span><br><span class="line"># 说明：只能清空管理表，也就是内部表；清空外部表，会产生错误</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p><strong>注意：truncate 和 drop：<br> 如果 hdfs 开启了回收站，drop 删除的表数据是可以从回收站恢复的，表结构恢复不了，需要自己重新创建；truncate 清空的表是不进回收站的，所以无法恢复truncate清空的表<br> 所以 truncate 一定慎用，一旦清空将无力回天</strong></p>
</blockquote>
<h4 id="向hive表中加载数据"><a href="#向hive表中加载数据" class="headerlink" title="向hive表中加载数据"></a>向hive表中加载数据</h4><ul>
<li>直接向分区表中插入数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span>(<span class="keyword">month</span> <span class="operator">=</span><span class="string">&#x27;201807&#x27;</span>) <span class="keyword">values</span> (<span class="string">&#x27;001&#x27;</span>,<span class="string">&#x27;002&#x27;</span>,<span class="string">&#x27;100&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>通过load方式加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/score.csv&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> score <span class="keyword">partition</span>(<span class="keyword">month</span><span class="operator">=</span><span class="string">&#x27;201806&#x27;</span>);</span><br></pre></td></tr></table></figure></div>

<ul>
<li>通过查询方式加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">table</span> score2 <span class="keyword">partition</span>(<span class="keyword">month</span> <span class="operator">=</span> <span class="string">&#x27;201806&#x27;</span>) <span class="keyword">select</span> s_id,c_id,s_score <span class="keyword">from</span> score1;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>查询语句中创建表并加载数据</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> score2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score1;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>在创建表是通过location指定加载数据的路径</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">external</span> <span class="keyword">table</span> score6 (s_id string,c_id string,s_score <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> location <span class="string">&#x27;/myscore&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>export导出与import 导入 hive表数据（内部表操作）</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> techer2 <span class="keyword">like</span> techer; <span class="comment">--依据已有表结构创建表</span></span><br><span class="line"></span><br><span class="line">export <span class="keyword">table</span> techer <span class="keyword">to</span>  <span class="string">&#x27;/export/techer&#x27;</span>;</span><br><span class="line"></span><br><span class="line">import <span class="keyword">table</span> techer2 <span class="keyword">from</span> <span class="string">&#x27;/export/techer&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<h4 id="hive表中数据导出"><a href="#hive表中数据导出" class="headerlink" title="hive表中数据导出"></a>hive表中数据导出</h4><ul>
<li>insert导出</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 将查询的结果导出到本地</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> directory <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score;</span><br><span class="line"></span><br><span class="line"># 将查询的结果格式化导出到本地</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> directory <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> collection items terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> student;</span><br><span class="line"></span><br><span class="line"># 将查询的结果导出到HDFS上(没有<span class="keyword">local</span>)</span><br><span class="line"><span class="keyword">insert</span> overwrite directory <span class="string">&#x27;/export/servers/exporthive&#x27;</span> <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span> collection items terminated <span class="keyword">by</span> <span class="string">&#x27;#&#x27;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>Hadoop命令导出到本地</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dfs <span class="operator">-</span><span class="keyword">get</span> <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>exporthive<span class="operator">/</span><span class="number">000000</span>_0 <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>exporthive<span class="operator">/</span>local.txt;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>hive shell 命令导出</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 基本语法：（hive <span class="operator">-</span>f<span class="operator">/</span><span class="operator">-</span>e 执行语句或者脚本 <span class="operator">&gt;</span> file）</span><br><span class="line"></span><br><span class="line">hive <span class="operator">-</span>e &quot;select * from myhive.score;&quot; <span class="operator">&gt;</span> <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>exporthive<span class="operator">/</span>score.txt</span><br><span class="line"></span><br><span class="line">hive <span class="operator">-</span>f export.sh <span class="operator">&gt;</span> <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>exporthive<span class="operator">/</span>score.txt</span><br></pre></td></tr></table></figure></div>

<ul>
<li>export导出到HDFS上</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">export <span class="keyword">table</span> score <span class="keyword">to</span> <span class="string">&#x27;/export/exporthive/score&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<h2 id="hive的DQL查询语法"><a href="#hive的DQL查询语法" class="headerlink" title="hive的DQL查询语法"></a>hive的DQL查询语法</h2><h3 id="单表查询"><a href="#单表查询" class="headerlink" title="单表查询"></a>单表查询</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> [<span class="keyword">ALL</span> <span class="operator">|</span> <span class="keyword">DISTINCT</span>] select_expr, select_expr, ... </span><br><span class="line"><span class="keyword">FROM</span> table_reference</span><br><span class="line">[<span class="keyword">WHERE</span> where_condition] </span><br><span class="line">[<span class="keyword">GROUP</span> <span class="keyword">BY</span> col_list [<span class="keyword">HAVING</span> <span class="keyword">condition</span>]] </span><br><span class="line">[CLUSTER <span class="keyword">BY</span> col_list </span><br><span class="line">  <span class="operator">|</span> [DISTRIBUTE <span class="keyword">BY</span> col_list] [SORT <span class="keyword">BY</span><span class="operator">|</span> <span class="keyword">ORDER</span> <span class="keyword">BY</span> col_list] </span><br><span class="line">] </span><br><span class="line">[LIMIT number]</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：<br> 1、order by 会对输入做全局排序，因此只有一个reducer，会导致当输入规模较大时，需要较长的计算时间。<br> 2、sort by不是全局排序，其在数据进入reducer前完成排序。因此，如果用sort by进行排序，并且设置mapred.reduce.tasks&gt;1，则sort by只保证每个reducer的输出有序，不保证全局有序。<br> 3、distribute by(字段)根据指定的字段将数据分到不同的reducer，且分发算法是hash散列。<br> 4、Cluster by(字段) 除了具有Distribute by的功能外，还会对该字段进行排序。<br> 因此，如果分桶和sort字段是同一个时，此时，cluster by &#x3D; distribute by + sort by</p>
</blockquote>
<ul>
<li>WHERE语句</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score <span class="keyword">where</span> s_score <span class="operator">&lt;</span> <span class="number">60</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：<br> 小于某个值是不包含null的，如上查询结果是把 s_score 为 null 的行剔除的</p>
</blockquote>
<ul>
<li>GROUP BY 分组</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">select</span> s_id ,<span class="built_in">avg</span>(s_score) <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> s_id;</span><br><span class="line"></span><br><span class="line">分组后对数据进行筛选，使用<span class="keyword">having</span></span><br><span class="line"> <span class="keyword">select</span> s_id ,<span class="built_in">avg</span>(s_score) avgscore <span class="keyword">from</span> score <span class="keyword">group</span> <span class="keyword">by</span> s_id <span class="keyword">having</span> avgscore <span class="operator">&gt;</span> <span class="number">85</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：<br> 如果使用 group by 分组，则 select 后面只能写分组的字段或者聚合函数<br> where和having区别：<br> 1 having是在 group by 分完组之后再对数据进行筛选，所以having 要筛选的字段只能是分组字段或者聚合函数<br> 2 where 是从数据表中的字段直接进行的筛选的，所以不能跟在gruop by后面，也不能使用聚合函数</p>
</blockquote>
<ul>
<li>join 连接</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># <span class="keyword">INNER</span> <span class="keyword">JOIN</span> 内连接：只有进行连接的两个表中都存在与连接条件相匹配的数据才会被保留下来</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> techer t [<span class="keyword">inner</span>] <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id; <span class="comment">-- inner 可省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> 左外连接：左边所有数据会被返回，右边符合条件的被返回</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> techer t <span class="keyword">left</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id; <span class="comment">-- outer可省略</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RIGHT</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> 右外连接：右边所有数据会被返回，左边符合条件的被返回、</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> techer t <span class="keyword">right</span> <span class="keyword">join</span> course c <span class="keyword">on</span> t.t_id <span class="operator">=</span> c.t_id;</span><br><span class="line"></span><br><span class="line"><span class="keyword">FULL</span> <span class="keyword">OUTER</span> <span class="keyword">JOIN</span> 满外(全外)连接: 将会返回所有表中符合条件的所有记录。如果任一表的指定字段没有符合条件的值的话，那么就使用<span class="keyword">NULL</span>值替代。</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> techer t <span class="keyword">FULL</span> <span class="keyword">JOIN</span> course c <span class="keyword">ON</span> t.t_id <span class="operator">=</span> c.t_id ;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注：1. hive2版本已经支持不等值连接，就是 join on条件后面可以使用大于小于符号了;并且也支持 join on 条件后跟or (早前版本 on 后只支持 &#x3D; 和 and，不支持 &gt; &lt; 和 or)<br> 2.如hive执行引擎使用MapReduce，一个join就会启动一个job，一条sql语句中如有多个join，则会启动多个job</p>
</blockquote>
<blockquote>
<p>注意：表之间用逗号(,)连接和 inner join 是一样的<br> select * from table_a,table_b where table_a.id&#x3D;table_b.id;<br> 它们的执行效率没有区别，只是书写方式不同，用逗号是sql 89标准，join 是sql 92标准。用逗号连接后面过滤条件用 where ，用 join 连接后面过滤条件是 on。</p>
</blockquote>
<ul>
<li>order by 排序</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 全局排序，只会有一个reduce</span><br><span class="line"><span class="keyword">ASC</span>（ascend）: 升序（默认） <span class="keyword">DESC</span>（descend）: 降序</span><br><span class="line"><span class="keyword">SELECT</span> <span class="operator">*</span> <span class="keyword">FROM</span> student s <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> score sco <span class="keyword">ON</span> s.s_id <span class="operator">=</span> sco.s_id <span class="keyword">ORDER</span> <span class="keyword">BY</span> sco.s_score <span class="keyword">DESC</span>;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：order by 是全局排序，所以最后只有一个reduce，也就是在一个节点执行，如果数据量太大，就会耗费较长时间</p>
</blockquote>
<ul>
<li>sort by 局部排序</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 每个MapReduce内部进行排序，对全局结果集来说不是排序。</span><br><span class="line"></span><br><span class="line"># 设置reduce个数</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces<span class="operator">=</span><span class="number">3</span>;</span><br><span class="line"></span><br><span class="line"># 查看设置reduce个数</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces;</span><br><span class="line"></span><br><span class="line"># 查询成绩按照成绩降序排列</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score sort <span class="keyword">by</span> s_score;</span><br><span class="line"> </span><br><span class="line"># 将查询结果导入到文件中（按照成绩降序排列）</span><br><span class="line"><span class="keyword">insert</span> overwrite <span class="keyword">local</span> directory <span class="string">&#x27;/export/servers/hivedatas/sort&#x27;</span> <span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score sort <span class="keyword">by</span> s_score;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>distribute by  分区排序</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># distribute <span class="keyword">by</span>：类似MR中<span class="keyword">partition</span>，进行分区，结合sort <span class="keyword">by</span>使用</span><br><span class="line"></span><br><span class="line"># 设置reduce的个数，将我们对应的s_id划分到对应的reduce当中去</span><br><span class="line"><span class="keyword">set</span> mapreduce.job.reduces<span class="operator">=</span><span class="number">7</span>;</span><br><span class="line"></span><br><span class="line"># 通过distribute <span class="keyword">by</span>  进行数据的分区</span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> score distribute <span class="keyword">by</span> s_id sort <span class="keyword">by</span> s_score;</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：Hive要求 distribute by 语句要写在 sort by 语句之前</p>
</blockquote>
<ul>
<li>cluster by</li>
</ul>
<div class="highlight-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">当distribute <span class="keyword">by</span>和sort <span class="keyword">by</span>字段相同时，可以使用cluster <span class="keyword">by</span>方式.</span><br><span class="line">cluster <span class="keyword">by</span>除了具有distribute <span class="keyword">by</span>的功能外还兼具sort <span class="keyword">by</span>的功能。但是排序只能是正序排序，不能指定排序规则为ASC或者DESC。</span><br><span class="line"></span><br><span class="line">以下两种写法等价</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score cluster <span class="keyword">by</span> s_id;</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> score distribute <span class="keyword">by</span> s_id sort <span class="keyword">by</span> s_id;</span><br></pre></td></tr></table></figure></div>

<h2 id="Hive函数"><a href="#Hive函数" class="headerlink" title="Hive函数"></a>Hive函数</h2><h3 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive支持 <span class="built_in">count</span>(),<span class="built_in">max</span>(),<span class="built_in">min</span>(),<span class="built_in">sum</span>(),<span class="built_in">avg</span>() 等常用的聚合函数</span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>注意：<br> 聚合操作时要注意null值<br> count(*) 包含null值，统计所有行数<br> count(id) 不包含null值<br> min 求最小值是不包含null，除非所有值都是null<br> avg 求平均值也是不包含null</p>
</blockquote>
<ul>
<li>非空集合总体变量函数: var_pop</li>
</ul>
<div class="highlight-container" data-rel="Makefile"><figure class="iseeu highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">语法: var_pop(col)</span></span><br><span class="line"><span class="section">返回值: double</span></span><br><span class="line"><span class="section">说明: 统计结果集中col非空集合的总体变量（忽略null）</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>非空集合样本变量函数: var_samp</li>
</ul>
<div class="highlight-container" data-rel="Makefile"><figure class="iseeu highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">语法: var_samp (col)</span></span><br><span class="line"><span class="section">返回值: double</span></span><br><span class="line"><span class="section">说明: 统计结果集中col非空集合的样本变量（忽略null）</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>总体标准偏离函数: stddev_pop</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">stddev_pop</span>(col)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 该函数计算总体标准偏离，并返回总体变量的平方根，其返回值与VAR_POP函数的平方根相同</span><br></pre></td></tr></table></figure></div>

<ul>
<li>中位数函数: percentile</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法: percentile(<span class="type">BIGINT</span> col, p)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 求准确的第pth个百分位数，p必须介于<span class="number">0</span>和<span class="number">1</span>之间，但是col字段目前只支持整数，不支持浮点数类型</span><br></pre></td></tr></table></figure></div>

<h3 id="关系运算"><a href="#关系运算" class="headerlink" title="关系运算"></a>关系运算</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">支持：等值(<span class="operator">=</span>)、不等值(<span class="operator">!=</span> 或 <span class="operator">&lt;&gt;</span>)、小于(<span class="operator">&lt;</span>)、小于等于(<span class="operator">&lt;=</span>)、大于(<span class="operator">&gt;</span>)、大于等于(<span class="operator">&gt;=</span>)</span><br><span class="line"></span><br><span class="line">空值判断(<span class="keyword">is</span> <span class="keyword">null</span>)、非空判断(<span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">null</span>)</span><br></pre></td></tr></table></figure></div>

<ul>
<li>LIKE比较: LIKE</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法: A <span class="keyword">LIKE</span> B</span><br><span class="line">操作类型: strings</span><br><span class="line">描述: 如果字符串A或者字符串B为<span class="keyword">NULL</span>，则返回<span class="keyword">NULL</span>；如果字符串A符合表达式B 的正则语法，则为<span class="literal">TRUE</span>；否则为<span class="literal">FALSE</span>。B中字符”_”表示任意单个字符，而字符”<span class="operator">%</span>”表示任意数量的字符。</span><br></pre></td></tr></table></figure></div>

<ul>
<li>JAVA的LIKE操作: RLIKE</li>
</ul>
<div class="highlight-container" data-rel="Less"><figure class="iseeu highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="selector-tag">A</span> <span class="selector-tag">RLIKE</span> <span class="selector-tag">B</span></span><br><span class="line">操作类型: <span class="selector-tag">strings</span></span><br><span class="line">描述: 如果字符串<span class="selector-tag">A</span>或者字符串<span class="selector-tag">B</span>为<span class="selector-tag">NULL</span>，则返回<span class="selector-tag">NULL</span>；如果字符串<span class="selector-tag">A</span>符合<span class="selector-tag">JAVA</span>正则表达式<span class="selector-tag">B</span>的正则语法，则为<span class="selector-tag">TRUE</span>；否则为<span class="selector-tag">FALSE</span>。</span><br></pre></td></tr></table></figure></div>

<ul>
<li>REGEXP操作: REGEXP</li>
</ul>
<div class="highlight-container" data-rel="Csharp"><figure class="iseeu highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: A REGEXP B</span><br><span class="line">操作类型: strings</span><br><span class="line">描述: 功能与RLIKE相同</span><br><span class="line">示例：<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> tableName <span class="keyword">where</span> <span class="string">&#x27;footbar&#x27;</span> REGEXP <span class="string">&#x27;^f.*r$&#x27;</span>;</span><br><span class="line">结果：<span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h3 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">支持所有数值类型：加(<span class="operator">+</span>)、减(<span class="operator">-</span>)、乘(<span class="operator">*</span>)、除(<span class="operator">/</span>)、取余(<span class="operator">%</span>)、位与(<span class="operator">&amp;</span>)、位或(<span class="operator">|</span>)、位异或(<span class="operator">^</span>)、位取反(<span class="operator">~</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="逻辑运算"><a href="#逻辑运算" class="headerlink" title="逻辑运算"></a>逻辑运算</h3><div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">支持：逻辑与(<span class="keyword">and</span>)、逻辑或(<span class="keyword">or</span>)、逻辑非(<span class="keyword">not</span>)</span><br></pre></td></tr></table></figure></div>

<h3 id="数值运算"><a href="#数值运算" class="headerlink" title="数值运算"></a>数值运算</h3><ul>
<li>取整函数: round</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: round(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="type">BIGINT</span></span><br><span class="line">说明: 返回<span class="keyword">double</span>类型的整数值部分 （遵循四舍五入）</span><br><span class="line">示例：<span class="keyword">select</span> round(<span class="number">3.1415926</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">结果：<span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>指定精度取整函数: round</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: round(<span class="keyword">double</span> a, <span class="type">int</span> d)</span><br><span class="line">返回值: <span class="keyword">DOUBLE</span></span><br><span class="line">说明: 返回指定精度d的<span class="keyword">double</span>类型</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> round(<span class="number">3.1415926</span>,<span class="number">4</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">3.1416</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>向下取整函数: floor</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">floor</span>(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="type">BIGINT</span></span><br><span class="line">说明: 返回等于或者小于该<span class="keyword">double</span>变量的最大的整数</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">floor</span>(<span class="number">3.641</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>向上取整函数: ceil</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">ceil</span>(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="type">BIGINT</span></span><br><span class="line">说明: 返回等于或者大于该<span class="keyword">double</span>变量的最小的整数</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">ceil</span>(<span class="number">3.1415926</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>取随机数函数: rand</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法: rand(),rand(<span class="type">int</span> seed)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 返回一个<span class="number">0</span>到<span class="number">1</span>范围内的随机数。如果指定种子seed，则会等到一个稳定的随机数序列</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> rand() <span class="keyword">from</span> tableName; <span class="comment">-- 每次执行此语句得到的结果都不同</span></span><br><span class="line"><span class="number">0.5577432776034763</span></span><br><span class="line"></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> rand(<span class="number">100</span>) ;  <span class="comment">-- 只要指定种子，每次执行此语句得到的结果一样的</span></span><br><span class="line"><span class="number">0.7220096548596434</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>自然指数函数: exp</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">exp</span>(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 返回自然对数e的a次方</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">exp</span>(<span class="number">2</span>) ;</span><br><span class="line"><span class="number">7.38905609893065</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>以10为底对数函数: log10</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">log10</span>(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 返回以<span class="number">10</span>为底的a的对数</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">log10</span>(<span class="number">100</span>) ;</span><br><span class="line"><span class="number">2.0</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>此外还有：以2为底对数函数: log2()、对数函数: log()</p>
</blockquote>
<ul>
<li>幂运算函数: pow</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: pow(<span class="keyword">double</span> a, <span class="keyword">double</span> p)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 返回a的p次幂</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> pow(<span class="number">2</span>,<span class="number">4</span>) ;</span><br><span class="line"><span class="number">16.0</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>开平方函数: sqrt</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">sqrt</span>(<span class="keyword">double</span> a)</span><br><span class="line">返回值: <span class="keyword">double</span></span><br><span class="line">说明: 返回a的平方根</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">sqrt</span>(<span class="number">16</span>) ;</span><br><span class="line"><span class="number">4.0</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>二进制函数: bin</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: bin(<span class="type">BIGINT</span> a)</span><br><span class="line">返回值: string</span><br><span class="line">说明: 返回a的二进制代码表示</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> bin(<span class="number">7</span>) ;</span><br><span class="line"><span class="number">111</span></span><br></pre></td></tr></table></figure></div>

<blockquote>
<p>十六进制函数: hex()、将十六进制转化为字符串函数: unhex()<br> 进制转换函数: conv(bigint num, int from_base, int to_base) 说明: 将数值num从from_base进制转化到to_base进制</p>
</blockquote>
<blockquote>
<p>此外还有很多数学函数： 绝对值函数: abs()、正取余函数: pmod()、正弦函数: sin()、反正弦函数: asin()、余弦函数: cos()、反余弦函数: acos()、positive函数: positive()、negative函数: negative()</p>
</blockquote>
<h3 id="条件函数"><a href="#条件函数" class="headerlink" title="条件函数"></a>条件函数</h3><ul>
<li>If函数: if</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: if(<span class="type">boolean</span> testCondition, T valueTrue, T valueFalseOrNull)</span><br><span class="line">返回值: T</span><br><span class="line">说明: 当条件testCondition为<span class="literal">TRUE</span>时，返回valueTrue；否则返回valueFalseOrNull</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> if(<span class="number">1</span><span class="operator">=</span><span class="number">2</span>,<span class="number">100</span>,<span class="number">200</span>) ;</span><br><span class="line"><span class="number">200</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> if(<span class="number">1</span><span class="operator">=</span><span class="number">1</span>,<span class="number">100</span>,<span class="number">200</span>) ;</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>非空查找函数: coalesce</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">coalesce</span>(T v1, T v2, …)</span><br><span class="line">返回值: T</span><br><span class="line">说明: 返回参数中的第一个非空值；如果所有值都为<span class="keyword">NULL</span>，那么返回<span class="keyword">NULL</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">coalesce</span>(<span class="keyword">null</span>,<span class="string">&#x27;100&#x27;</span>,<span class="string">&#x27;50&#x27;</span>) ;</span><br><span class="line"><span class="number">100</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>条件判断函数：case when (两种写法，其一)</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">case</span> <span class="keyword">when</span> a <span class="keyword">then</span> b [<span class="keyword">when</span> c <span class="keyword">then</span> d]<span class="operator">*</span> [<span class="keyword">else</span> e] <span class="keyword">end</span></span><br><span class="line">返回值: T</span><br><span class="line">说明：如果a为<span class="literal">TRUE</span>,则返回b；如果c为<span class="literal">TRUE</span>，则返回d；否则返回e</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">case</span> <span class="keyword">when</span> <span class="number">1</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;tom&#x27;</span> <span class="keyword">when</span> <span class="number">2</span><span class="operator">=</span><span class="number">2</span> <span class="keyword">then</span> <span class="string">&#x27;mary&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;tim&#x27;</span> <span class="keyword">end</span> <span class="keyword">from</span> tableName;</span><br><span class="line">mary</span><br></pre></td></tr></table></figure></div>

<ul>
<li>条件判断函数：case when (两种写法，其二)</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">case</span> a <span class="keyword">when</span> b <span class="keyword">then</span> c [<span class="keyword">when</span> d <span class="keyword">then</span> e]<span class="operator">*</span> [<span class="keyword">else</span> f] <span class="keyword">end</span></span><br><span class="line">返回值: T</span><br><span class="line">说明：如果a等于b，那么返回c；如果a等于d，那么返回e；否则返回f</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">Select</span> <span class="keyword">case</span> <span class="number">100</span> <span class="keyword">when</span> <span class="number">50</span> <span class="keyword">then</span> <span class="string">&#x27;tom&#x27;</span> <span class="keyword">when</span> <span class="number">100</span> <span class="keyword">then</span> <span class="string">&#x27;mary&#x27;</span> <span class="keyword">else</span> <span class="string">&#x27;tim&#x27;</span> <span class="keyword">end</span> <span class="keyword">from</span> tableName;</span><br><span class="line">mary</span><br></pre></td></tr></table></figure></div>

<h3 id="日期函数"><a href="#日期函数" class="headerlink" title="日期函数"></a>日期函数</h3><blockquote>
<p>注：以下SQL语句中的 from tableName 可去掉，不影响查询结果</p>
</blockquote>
<ul>
<li><ol>
<li>获取当前UNIX时间戳函数: unix_timestamp</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: unix_timestamp()</span><br><span class="line">返回值: <span class="type">bigint</span></span><br><span class="line">说明: 获得当前时区的UNIX时间戳</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> unix_timestamp() <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">1616906976</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>UNIX时间戳转日期函数: from_unixtime</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: from_unixtime(<span class="type">bigint</span> unixtime[, string format])</span><br><span class="line">返回值: string</span><br><span class="line">说明: 转化UNIX时间戳（从<span class="number">1970</span><span class="number">-01</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> UTC到指定时间的秒数）到当前时区的时间格式</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> from_unixtime(<span class="number">1616906976</span>,<span class="string">&#x27;yyyyMMdd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">20210328</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转UNIX时间戳函数: unix_timestamp</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: unix_timestamp(string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">bigint</span></span><br><span class="line">说明: 转换格式为&quot;yyyy-MM-dd HH:mm:ss&quot;的日期到UNIX时间戳。如果转化失败，则返回<span class="number">0</span>。</span><br><span class="line">hive<span class="operator">&gt;</span>  <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2021-03-08 14:21:15&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">1615184475</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>指定格式日期转UNIX时间戳函数: unix_timestamp</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: unix_timestamp(string <span class="type">date</span>, string <span class="keyword">pattern</span>)</span><br><span class="line">返回值: <span class="type">bigint</span></span><br><span class="line">说明: 转换<span class="keyword">pattern</span>格式的日期到UNIX时间戳。如果转化失败，则返回<span class="number">0</span>。</span><br><span class="line">hive<span class="operator">&gt;</span>  <span class="keyword">select</span> unix_timestamp(<span class="string">&#x27;2021-03-08 14:21:15&#x27;</span>,<span class="string">&#x27;yyyyMMdd HH:mm:ss&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">1615184475</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期时间转日期函数: to_date</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: to_date(string <span class="type">timestamp</span>)</span><br><span class="line">返回值: string</span><br><span class="line">说明: 返回日期时间字段中的日期部分。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> to_date(<span class="string">&#x27;2021-03-28 14:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2021</span><span class="number">-03</span><span class="number">-28</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转年函数: year</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">year</span>(string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的年。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">year</span>(<span class="string">&#x27;2021-03-28 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2021</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">year</span>(<span class="string">&#x27;2021-03-28&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2021</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转月函数: month</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">month</span> (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的月份。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">month</span>(<span class="string">&#x27;2020-12-28 12:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">12</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">month</span>(<span class="string">&#x27;2021-03-08&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">8</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转天函数: day</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">day</span> (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的天。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">day</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">8</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">day</span>(<span class="string">&#x27;2020-12-24&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">24</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转小时函数: hour</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">hour</span> (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的小时。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">hour</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转分钟函数: minute</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">minute</span> (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的分钟。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">minute</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转秒函数: second</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">second</span> (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期中的秒。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="keyword">second</span>(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期转周函数: weekofyear</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: weekofyear (string <span class="type">date</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回日期在当前的周数。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> weekofyear(<span class="string">&#x27;2020-12-08 10:03:01&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">49</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期比较函数: datediff</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: datediff(string enddate, string startdate)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回结束日期减去开始日期的天数。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> datediff(<span class="string">&#x27;2020-12-08&#x27;</span>,<span class="string">&#x27;2012-05-09&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">213</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期增加函数: date_add</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: date_add(string startdate, <span class="type">int</span> days)</span><br><span class="line">返回值: string</span><br><span class="line">说明: 返回开始日期startdate增加days天后的日期。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> date_add(<span class="string">&#x27;2020-12-08&#x27;</span>,<span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2020</span><span class="number">-12</span><span class="number">-18</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>日期减少函数: date_sub</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: date_sub (string startdate, <span class="type">int</span> days)</span><br><span class="line">返回值: string</span><br><span class="line">说明: 返回开始日期startdate减少days天后的日期。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> date_sub(<span class="string">&#x27;2020-12-08&#x27;</span>,<span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2020</span><span class="number">-11</span><span class="number">-28</span></span><br></pre></td></tr></table></figure></div>

<h3 id="字符串函数"><a href="#字符串函数" class="headerlink" title="字符串函数"></a>字符串函数</h3><ul>
<li><ol>
<li>字符串长度函数：length</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: length(string A)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明：返回字符串A的长度</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> length(<span class="string">&#x27;abcedfg&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">7</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串反转函数：reverse</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: reverse(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回字符串A的反转结果</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> reverse(<span class="string">&#x27;abcedfg&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">gfdecba</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串连接函数：concat</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: concat(string A, string B…)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回输入字符串连接后的结果，支持任意个输入字符串</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> concat(<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;def’,&#x27;</span>gh<span class="string">&#x27;)from tableName;</span></span><br><span class="line"><span class="string">abcdefgh</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>带分隔符字符串连接函数：concat_ws</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: concat_ws(string SEP, string A, string B…)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回输入字符串连接后的结果，SEP表示各个字符串间的分隔符</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> concat_ws(<span class="string">&#x27;,&#x27;</span>,<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;def&#x27;</span>,<span class="string">&#x27;gh&#x27;</span>)<span class="keyword">from</span> tableName;</span><br><span class="line">abc,def,gh</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串截取函数：substr,substring</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法: substr(string A, <span class="type">int</span> <span class="keyword">start</span>),<span class="built_in">substring</span>(string A, <span class="type">int</span> <span class="keyword">start</span>)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回字符串A从<span class="keyword">start</span>位置到结尾的字符串</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> substr(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">3</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">cde</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">3</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">cde</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> substr(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">-1</span>) <span class="keyword">from</span> tableName; （和ORACLE相同）</span><br><span class="line">e</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串截取函数：substr,substring</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">语法: substr(string A, <span class="type">int</span> <span class="keyword">start</span>, <span class="type">int</span> len),<span class="built_in">substring</span>(string A, <span class="type">int</span> <span class="keyword">start</span>, <span class="type">int</span> len)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回字符串A从<span class="keyword">start</span>位置开始，长度为len的字符串</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> substr(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">3</span>,<span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">cd</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">3</span>,<span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">cd</span><br><span class="line">hive<span class="operator">&gt;</span><span class="keyword">select</span> <span class="built_in">substring</span>(<span class="string">&#x27;abcde&#x27;</span>,<span class="number">-2</span>,<span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">de</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串转大写函数：upper,ucase</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">upper</span>(string A) ucase(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回字符串A的大写格式</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">upper</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">ABSED</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> ucase(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">ABSED</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>字符串转小写函数：lower,lcase</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">lower</span>(string A) lcase(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回字符串A的小写格式</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">lower</span>(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">absed</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> lcase(<span class="string">&#x27;abSEd&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">absed</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>去空格函数：trim</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="built_in">trim</span>(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：去除字符串两边的空格</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">trim</span>(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">abc</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>左边去空格函数：ltrim</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: ltrim(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：去除字符串左边的空格</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> ltrim(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">abc</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>右边去空格函数：rtrim</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: rtrim(string A)</span><br><span class="line">返回值: string</span><br><span class="line">说明：去除字符串右边的空格</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> rtrim(<span class="string">&#x27; abc &#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">abc</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>正则表达式替换函数：regexp_replace</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: regexp_replace(string A, string B, string C)</span><br><span class="line">返回值: string</span><br><span class="line">说明：将字符串A中的符合java正则表达式B的部分替换为C。注意，在有些情况下要使用转义字符,类似oracle中的regexp_replace函数。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> regexp_replace(<span class="string">&#x27;foobar&#x27;</span>, <span class="string">&#x27;oo|ar&#x27;</span>, <span class="string">&#x27;&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">fb</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>正则表达式解析函数：regexp_extract</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">语法: regexp_extract(string subject, string <span class="keyword">pattern</span>, <span class="type">int</span> index)</span><br><span class="line">返回值: string</span><br><span class="line">说明：将字符串subject按照<span class="keyword">pattern</span>正则表达式的规则拆分，返回index指定的字符。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">1</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">the</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">2</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">bar</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> regexp_extract(<span class="string">&#x27;foothebar&#x27;</span>, <span class="string">&#x27;foo(.*?)(bar)&#x27;</span>, <span class="number">0</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">foothebar</span><br><span class="line">strong<span class="operator">&gt;</span>注意，在有些情况下要使用转义字符，下面的等号要用双竖线转义，这是java正则表达式的规则。</span><br><span class="line"><span class="keyword">select</span> data_field,</span><br><span class="line">regexp_extract(data_field,<span class="string">&#x27;.*?bgStart\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> aaa,</span><br><span class="line">regexp_extract(data_field,<span class="string">&#x27;.*?contentLoaded_headStart\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> bbb,</span><br><span class="line">regexp_extract(data_field,<span class="string">&#x27;.*?AppLoad2Req\\=([^&amp;]+)&#x27;</span>,<span class="number">1</span>) <span class="keyword">as</span> ccc </span><br><span class="line"><span class="keyword">from</span> pt_nginx_loginlog_st </span><br><span class="line"><span class="keyword">where</span> pt <span class="operator">=</span> <span class="string">&#x27;2021-03-28&#x27;</span> limit <span class="number">2</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>URL解析函数：parse_url</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">语法: parse_url(string urlString, string partToExtract [, string keyToExtract])</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回URL中指定的部分。partToExtract的有效值为：HOST, PATH, QUERY, <span class="keyword">REF</span>, PROTOCOL, AUTHORITY, FILE, <span class="keyword">and</span> USERINFO.</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> parse_url</span><br><span class="line">(<span class="string">&#x27;https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#x27;</span>, <span class="string">&#x27;HOST&#x27;</span>) </span><br><span class="line"><span class="keyword">from</span> tableName;</span><br><span class="line">www.tableName.com </span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> parse_url</span><br><span class="line">(<span class="string">&#x27;https://www.tableName.com/path1/p.php?k1=v1&amp;k2=v2#Ref1&#x27;</span>, <span class="string">&#x27;QUERY&#x27;</span>, <span class="string">&#x27;k1&#x27;</span>)</span><br><span class="line"> <span class="keyword">from</span> tableName;</span><br><span class="line">v1</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>json解析函数：get_json_object</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">语法: get_json_object(string json_string, string path)</span><br><span class="line">返回值: string</span><br><span class="line">说明：解析json的字符串json_string,返回path指定的内容。如果输入的json字符串无效，那么返回<span class="keyword">NULL</span>。</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span>  get_json_object(<span class="string">&#x27;&#123;&quot;store&quot;:&#123;&quot;fruit&quot;:\[&#123;&quot;weight&quot;:8,&quot;type&quot;:&quot;apple&quot;&#125;,&#123;&quot;weight&quot;:9,&quot;type&quot;:&quot;pear&quot;&#125;], &quot;bicycle&quot;:&#123;&quot;price&quot;:19.95,&quot;color&quot;:&quot;red&quot;&#125; &#125;,&quot;email&quot;:&quot;amy@only_for_json_udf_test.net&quot;,&quot;owner&quot;:&quot;amy&quot;&#125;&#x27;</span>,<span class="string">&#x27;$.owner&#x27;</span>) <span class="keyword">from</span> tableName;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>空格字符串函数：space</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法: space(<span class="type">int</span> n)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回长度为n的字符串</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> space(<span class="number">10</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> length(space(<span class="number">10</span>)) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>重复字符串函数：repeat</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: repeat(string str, <span class="type">int</span> n)</span><br><span class="line">返回值: string</span><br><span class="line">说明：返回重复n次后的str字符串</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> repeat(<span class="string">&#x27;abc&#x27;</span>,<span class="number">5</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">abcabcabcabcabc</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>首字符ascii函数：ascii</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: ascii(string str)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明：返回字符串str第一个字符的ascii码</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> ascii(<span class="string">&#x27;abcde&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">97</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>左补足函数：lpad</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法: lpad(string str, <span class="type">int</span> len, string pad)</span><br><span class="line">返回值: string</span><br><span class="line">说明：将str进行用pad进行左补足到len位</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> lpad(<span class="string">&#x27;abc&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;td&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">tdtdtdtabc</span><br><span class="line">注意：与GP，ORACLE不同，pad 不能默认</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>右补足函数：rpad</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: rpad(string str, <span class="type">int</span> len, string pad)</span><br><span class="line">返回值: string</span><br><span class="line">说明：将str进行用pad进行右补足到len位</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> rpad(<span class="string">&#x27;abc&#x27;</span>,<span class="number">10</span>,<span class="string">&#x27;td&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">abctdtdtdt</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>分割字符串函数: split</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: split(string str, string pat)</span><br><span class="line">返回值: <span class="keyword">array</span></span><br><span class="line">说明: 按照pat字符串分割str，会返回分割后的字符串数组</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> split(<span class="string">&#x27;abtcdtef&#x27;</span>,<span class="string">&#x27;t&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line">[&quot;ab&quot;,&quot;cd&quot;,&quot;ef&quot;]</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>集合查找函数: find_in_set</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: find_in_set(string str, string strList)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回str在strlist第一次出现的位置，strlist是用逗号分割的字符串。如果没有找该str字符，则返回<span class="number">0</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> find_in_set(<span class="string">&#x27;ab&#x27;</span>,<span class="string">&#x27;ef,ab,de&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">2</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> find_in_set(<span class="string">&#x27;at&#x27;</span>,<span class="string">&#x27;ef,ab,de&#x27;</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure></div>

<h3 id="复合类型构建操作"><a href="#复合类型构建操作" class="headerlink" title="复合类型构建操作"></a>复合类型构建操作</h3><ul>
<li>Map类型构建: map</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: map (key1, value1, key2, value2, …)</span><br><span class="line">说明：根据输入的key和<span class="keyword">value</span>对构建map类型</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">Create</span> <span class="keyword">table</span> mapTable <span class="keyword">as</span> <span class="keyword">select</span> map(<span class="string">&#x27;100&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;200&#x27;</span>,<span class="string">&#x27;mary&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">describe</span> mapTable;</span><br><span class="line">t       map<span class="operator">&lt;</span>string ,string<span class="operator">&gt;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">&#123;&quot;100&quot;:&quot;tom&quot;,&quot;200&quot;:&quot;mary&quot;&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>Struct类型构建: struct</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: struct(val1, val2, val3, …)</span><br><span class="line">说明：根据输入的参数构建结构体struct类型</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> struct_table <span class="keyword">as</span> <span class="keyword">select</span> struct(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;mary&#x27;</span>,<span class="string">&#x27;tim&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">describe</span> struct_table;</span><br><span class="line">t       struct<span class="operator">&lt;</span>col1:string ,col2:string,col3:string<span class="operator">&gt;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">&#123;&quot;col1&quot;:&quot;tom&quot;,&quot;col2&quot;:&quot;mary&quot;,&quot;col3&quot;:&quot;tim&quot;&#125;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>array类型构建: array</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: <span class="keyword">array</span>(val1, val2, …)</span><br><span class="line">说明：根据输入的参数构建数组<span class="keyword">array</span>类型</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> arr_table <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">array</span>(&quot;tom&quot;,&quot;mary&quot;,&quot;tim&quot;) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">describe</span> tableName;</span><br><span class="line">t       <span class="keyword">array</span><span class="operator">&lt;</span>string<span class="operator">&gt;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">[&quot;tom&quot;,&quot;mary&quot;,&quot;tim&quot;]</span><br></pre></td></tr></table></figure></div>

<h3 id="复杂类型访问操作"><a href="#复杂类型访问操作" class="headerlink" title="复杂类型访问操作"></a>复杂类型访问操作</h3><ul>
<li><ol>
<li>array类型访问: A[n]</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法: A[n]</span><br><span class="line">操作类型: A为<span class="keyword">array</span>类型，n为<span class="type">int</span>类型</span><br><span class="line">说明：返回数组A中的第n个变量值。数组的起始下标为<span class="number">0</span>。比如，A是个值为[<span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;bar&#x27;</span>]的数组类型，那么A[<span class="number">0</span>]将返回<span class="string">&#x27;foo&#x27;</span>,而A[<span class="number">1</span>]将返回<span class="string">&#x27;bar&#x27;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> arr_table2 <span class="keyword">as</span> <span class="keyword">select</span> <span class="keyword">array</span>(&quot;tom&quot;,&quot;mary&quot;,&quot;tim&quot;) <span class="keyword">as</span> t</span><br><span class="line"> <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t[<span class="number">0</span>],t[<span class="number">1</span>] <span class="keyword">from</span> arr_table2;</span><br><span class="line">tom     mary    tim</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>map类型访问: M[key]</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">语法: M[key]</span><br><span class="line">操作类型: M为map类型，key为map中的key值</span><br><span class="line">说明：返回map类型M中，key值为指定值的<span class="keyword">value</span>值。比如，M是值为&#123;<span class="string">&#x27;f&#x27;</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;foo&#x27;</span>, <span class="string">&#x27;b&#x27;</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;bar&#x27;</span>, <span class="string">&#x27;all&#x27;</span> <span class="operator">-</span><span class="operator">&gt;</span> <span class="string">&#x27;foobar&#x27;</span>&#125;的map类型，那么M[<span class="string">&#x27;all&#x27;</span>]将会返回<span class="string">&#x27;foobar&#x27;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">Create</span> <span class="keyword">table</span> map_table2 <span class="keyword">as</span> <span class="keyword">select</span> map(<span class="string">&#x27;100&#x27;</span>,<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;200&#x27;</span>,<span class="string">&#x27;mary&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t[<span class="string">&#x27;200&#x27;</span>],t[<span class="string">&#x27;100&#x27;</span>] <span class="keyword">from</span> map_table2;</span><br><span class="line">mary    tom</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>struct类型访问: S.x</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">语法: S.x</span><br><span class="line">操作类型: S为struct类型</span><br><span class="line">说明：返回结构体S中的x字段。比如，对于结构体struct foobar &#123;<span class="type">int</span> foo, <span class="type">int</span> bar&#125;，foobar.foo返回结构体中的foo字段</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> str_table2 <span class="keyword">as</span> <span class="keyword">select</span> struct(<span class="string">&#x27;tom&#x27;</span>,<span class="string">&#x27;mary&#x27;</span>,<span class="string">&#x27;tim&#x27;</span>) <span class="keyword">as</span> t <span class="keyword">from</span> tableName;</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">describe</span> tableName;</span><br><span class="line">t       struct<span class="operator">&lt;</span>col1:string ,col2:string,col3:string<span class="operator">&gt;</span></span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> t.col1,t.col3 <span class="keyword">from</span> str_table2;</span><br><span class="line">tom     tim</span><br></pre></td></tr></table></figure></div>

<h3 id="复杂类型长度统计函数"><a href="#复杂类型长度统计函数" class="headerlink" title="复杂类型长度统计函数"></a>复杂类型长度统计函数</h3><ul>
<li><ol>
<li>Map类型长度函数: size(Map&lt;k .V&gt;)</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: size(Map<span class="operator">&lt;</span>k .V<span class="operator">&gt;</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回map类型的长度</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> size(t) <span class="keyword">from</span> map_table2;</span><br><span class="line"><span class="number">2</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>array类型长度函数: size(Array)</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">语法: size(<span class="keyword">Array</span><span class="operator">&lt;</span>T<span class="operator">&gt;</span>)</span><br><span class="line">返回值: <span class="type">int</span></span><br><span class="line">说明: 返回<span class="keyword">array</span>类型的长度</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> size(t) <span class="keyword">from</span> arr_table2;</span><br><span class="line"><span class="number">4</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>类型转换函数  ***</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">类型转换函数: cast</span><br><span class="line">语法: <span class="built_in">cast</span>(expr <span class="keyword">as</span> <span class="operator">&lt;</span>type<span class="operator">&gt;</span>)</span><br><span class="line">返回值: Expected &quot;=&quot; <span class="keyword">to</span> follow &quot;type&quot;</span><br><span class="line">说明: 返回转换后的数据类型</span><br><span class="line">hive<span class="operator">&gt;</span> <span class="keyword">select</span> <span class="built_in">cast</span>(<span class="string">&#x27;1&#x27;</span> <span class="keyword">as</span> <span class="type">bigint</span>) <span class="keyword">from</span> tableName;</span><br><span class="line"><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h2 id="hive当中的lateral-view-与-explode以及reflect和窗口函数"><a href="#hive当中的lateral-view-与-explode以及reflect和窗口函数" class="headerlink" title="hive当中的lateral view 与 explode以及reflect和窗口函数"></a>hive当中的lateral view 与 explode以及reflect和窗口函数</h2><h3 id="使用explode函数将hive表中的Map和Array字段数据进行拆分"><a href="#使用explode函数将hive表中的Map和Array字段数据进行拆分" class="headerlink" title="使用explode函数将hive表中的Map和Array字段数据进行拆分"></a>使用explode函数将hive表中的Map和Array字段数据进行拆分</h3><p>​	lateral view用于和split、explode等UDTF一起使用的，能将一行数据拆分成多行数据，在此基础上可以对拆分的数据进行聚合，lateral view首先为原始表的每行调用UDTF，UDTF会把一行拆分成一行或者多行，lateral view在把结果组合，产生一个支持别名表的虚拟表。</p>
<p>​	其中explode还可以用于将hive一列中复杂的array或者map结构拆分成多行</p>
<p>需求：现在有数据格式如下</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zhangsan	child1,child2,child3,child4	k1:v1,k2:v2</span><br><span class="line"></span><br><span class="line">lisi	child5,child6,child7,child8	k3:v3,k4:v4</span><br></pre></td></tr></table></figure></div>

<p>​	字段之间使用\t分割，需求将所有的child进行拆开成为一列</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">----------+--+</span></span><br><span class="line"><span class="operator">|</span> mychild  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--+</span></span><br><span class="line"><span class="operator">|</span> child1   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child2   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child3   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child4   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child5   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child6   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child7   <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> child8   <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">----------+--+</span></span><br></pre></td></tr></table></figure></div>

<p>​	将map的key和value也进行拆开，成为如下结果</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+--+</span></span><br><span class="line"><span class="operator">|</span> mymapkey  <span class="operator">|</span> mymapvalue  <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+--+</span></span><br><span class="line"><span class="operator">|</span> k1        <span class="operator">|</span> v1          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> k2        <span class="operator">|</span> v2          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> k3        <span class="operator">|</span> v3          <span class="operator">|</span></span><br><span class="line"><span class="operator">|</span> k4        <span class="operator">|</span> v4          <span class="operator">|</span></span><br><span class="line"><span class="operator">+</span><span class="comment">-----------+-------------+--+</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>创建hive数据库</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">创建hive数据库</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> <span class="keyword">create</span> database hive_explode;</span><br><span class="line">hive (<span class="keyword">default</span>)<span class="operator">&gt;</span> use hive_explode;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>创建hive表，然后使用explode拆分map和array</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">create</span>  <span class="keyword">table</span> t3(name string,children <span class="keyword">array</span><span class="operator">&lt;</span>string<span class="operator">&gt;</span>,address Map<span class="operator">&lt;</span>string,string<span class="operator">&gt;</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;\t&#x27;</span>  collection items terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span> map keys terminated <span class="keyword">by</span> <span class="string">&#x27;:&#x27;</span> stored <span class="keyword">as</span> textFile;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">node03执行以下命令创建表数据文件</span><br><span class="line">	mkdir <span class="operator">-</span>p <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas<span class="operator">/</span></span><br><span class="line">	cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas<span class="operator">/</span></span><br><span class="line">	vim maparray</span><br><span class="line">内容如下:</span><br><span class="line">zhangsan	child1,child2,child3,child4	k1:v1,k2:v2</span><br><span class="line">lisi	child5,child6,child7,child8	k3:v3,k4:v4</span><br><span class="line"></span><br><span class="line">hive表当中加载数据</span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/maparray&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> t3;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>使用explode将hive当中数据拆开</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将<span class="keyword">array</span>当中的数据拆分开</span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">SELECT</span> explode(children) <span class="keyword">AS</span> myChild <span class="keyword">FROM</span> t3;</span><br><span class="line"></span><br><span class="line">将map当中的数据拆分开</span><br><span class="line"></span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">SELECT</span> explode(address) <span class="keyword">AS</span> (myMapKey, myMapValue) <span class="keyword">FROM</span> t3;</span><br></pre></td></tr></table></figure></div>

<h3 id="使用explode拆分json字符串"><a href="#使用explode拆分json字符串" class="headerlink" title="使用explode拆分json字符串"></a>使用explode拆分json字符串</h3><p>需求: 需求：现在有一些数据格式如下：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:shandong,b:beijing,c:hebei<span class="operator">|</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span><span class="operator">|</span>[&#123;&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:<span class="number">4900</span>,&quot;userCount&quot;:<span class="number">1900</span>,&quot;score&quot;:&quot;9.9&quot;&#125;,&#123;&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:<span class="number">2090</span>,&quot;userCount&quot;:<span class="number">78981</span>,&quot;score&quot;:&quot;9.8&quot;&#125;,&#123;&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:<span class="number">6987</span>,&quot;userCount&quot;:<span class="number">1600</span>,&quot;score&quot;:&quot;9.0&quot;&#125;]</span><br></pre></td></tr></table></figure></div>

<p>其中字段与字段之间的分隔符是 |</p>
<p>我们要解析得到所有的monthSales对应的值为以下这一列（行转列）</p>
<p>4900</p>
<p>2090</p>
<p>6987</p>
<ul>
<li><ol>
<li>创建hive表</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> explode_lateral_view</span><br><span class="line">                   <span class="operator">&gt;</span> (`area` string,</span><br><span class="line">                   <span class="operator">&gt;</span> `goods_id` string,</span><br><span class="line">                   <span class="operator">&gt;</span> `sale_info` string)</span><br><span class="line">                   <span class="operator">&gt;</span> <span class="type">ROW</span> FORMAT DELIMITED</span><br><span class="line">                   <span class="operator">&gt;</span> FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;|&#x27;</span></span><br><span class="line">                   <span class="operator">&gt;</span> STORED <span class="keyword">AS</span> textfile;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>准备数据并加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">准备数据如下</span><br><span class="line">cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas</span><br><span class="line">vim explode_json</span><br><span class="line"></span><br><span class="line">a:shandong,b:beijing,c:hebei<span class="operator">|</span><span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span><span class="operator">|</span>[&#123;&quot;source&quot;:&quot;7fresh&quot;,&quot;monthSales&quot;:<span class="number">4900</span>,&quot;userCount&quot;:<span class="number">1900</span>,&quot;score&quot;:&quot;9.9&quot;&#125;,&#123;&quot;source&quot;:&quot;jd&quot;,&quot;monthSales&quot;:<span class="number">2090</span>,&quot;userCount&quot;:<span class="number">78981</span>,&quot;score&quot;:&quot;9.8&quot;&#125;,&#123;&quot;source&quot;:&quot;jdmart&quot;,&quot;monthSales&quot;:<span class="number">6987</span>,&quot;userCount&quot;:<span class="number">1600</span>,&quot;score&quot;:&quot;9.0&quot;&#125;]</span><br><span class="line"></span><br><span class="line">加载数据到hive表当中去</span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/explode_json&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> explode_lateral_view;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>使用explode拆分Array</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> explode(split(goods_id,<span class="string">&#x27;,&#x27;</span>)) <span class="keyword">as</span> goods_id <span class="keyword">from</span> explode_lateral_view;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>使用explode拆解Map</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> explode(split(area,<span class="string">&#x27;,&#x27;</span>)) <span class="keyword">as</span> area <span class="keyword">from</span> explode_lateral_view;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>拆解json字段</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> explode(split(regexp_replace(regexp_replace(sale_info,<span class="string">&#x27;\\[\\&#123;&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;]&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;,\\&#123;&#x27;</span>)) <span class="keyword">as</span>  sale_info <span class="keyword">from</span> explode_lateral_view;</span><br><span class="line"></span><br><span class="line">然后我们想用get_json_object来获取key为monthSales的数据：</span><br><span class="line"></span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> get_json_object(explode(split(regexp_replace(regexp_replace(sale_info,<span class="string">&#x27;\\[\\&#123;&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;]&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;,\\&#123;&#x27;</span>)),<span class="string">&#x27;$.monthSales&#x27;</span>) <span class="keyword">as</span>  sale_info <span class="keyword">from</span> explode_lateral_view;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后挂了FAILED: SemanticException [Error <span class="number">10081</span>]: UDTF<span class="string">&#x27;s are not supported outside the SELECT clause, nor nested in expressions</span></span><br><span class="line"><span class="string">UDTF explode不能写在别的函数内</span></span><br><span class="line"><span class="string">如果你这么写，想查两个字段，select explode(split(area,&#x27;</span>,<span class="string">&#x27;)) as area,good_id from explode_lateral_view;</span></span><br><span class="line"><span class="string">会报错FAILED: SemanticException 1:40 Only a single expression in the SELECT clause is supported with UDTF&#x27;</span>s. Error encountered near token <span class="string">&#x27;good_id&#x27;</span></span><br><span class="line">使用UDTF的时候，只支持一个字段，这时候就需要<span class="keyword">LATERAL</span> <span class="keyword">VIEW</span>出场了</span><br></pre></td></tr></table></figure></div>

<h3 id="配合LATERAL-VIEW使用"><a href="#配合LATERAL-VIEW使用" class="headerlink" title="配合LATERAL  VIEW使用"></a>配合LATERAL  VIEW使用</h3><p>​	配合lateral view查询多个字段</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> goods_id2,sale_info <span class="keyword">from</span> explode_lateral_view <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(split(goods_id,<span class="string">&#x27;,&#x27;</span>))goods <span class="keyword">as</span> goods_id2;</span><br><span class="line"></span><br><span class="line">其中<span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(split(goods_id,<span class="string">&#x27;,&#x27;</span>))goods相当于一个虚拟表，与原表explode_lateral_view笛卡尔积关联</span><br></pre></td></tr></table></figure></div>

<p>​	也可以多重使用</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> goods_id2,sale_info,area2</span><br><span class="line">                    <span class="keyword">from</span> explode_lateral_view </span><br><span class="line">                    <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(split(goods_id,<span class="string">&#x27;,&#x27;</span>))goods <span class="keyword">as</span> goods_id2 </span><br><span class="line">                    <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(split(area,<span class="string">&#x27;,&#x27;</span>))area <span class="keyword">as</span> area2;也是三个表笛卡尔积的结果</span><br></pre></td></tr></table></figure></div>

<p>最终，我们可以通过下面的句子，把这个json格式的一行数据，完全转换成二维表的方式展现</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> get_json_object(concat(<span class="string">&#x27;&#123;&#x27;</span>,sale_info_1,<span class="string">&#x27;&#125;&#x27;</span>),<span class="string">&#x27;$.source&#x27;</span>) <span class="keyword">as</span> source,get_json_object(concat(<span class="string">&#x27;&#123;&#x27;</span>,sale_info_1,<span class="string">&#x27;&#125;&#x27;</span>),<span class="string">&#x27;$.monthSales&#x27;</span>) <span class="keyword">as</span> monthSales,get_json_object(concat(<span class="string">&#x27;&#123;&#x27;</span>,sale_info_1,<span class="string">&#x27;&#125;&#x27;</span>),<span class="string">&#x27;$.userCount&#x27;</span>) <span class="keyword">as</span> monthSales,get_json_object(concat(<span class="string">&#x27;&#123;&#x27;</span>,sale_info_1,<span class="string">&#x27;&#125;&#x27;</span>),<span class="string">&#x27;$.score&#x27;</span>) <span class="keyword">as</span> monthSales <span class="keyword">from</span> explode_lateral_view <span class="keyword">LATERAL</span> <span class="keyword">VIEW</span> explode(split(regexp_replace(regexp_replace(sale_info,<span class="string">&#x27;\\[\\&#123;&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;]&#x27;</span>,<span class="string">&#x27;&#x27;</span>),<span class="string">&#x27;&#125;,\\&#123;&#x27;</span>))sale_info <span class="keyword">as</span> sale_info_1;</span><br></pre></td></tr></table></figure></div>

<p>总结：</p>
<p>Lateral View通常和UDTF一起出现，为了解决UDTF不允许在select字段的问题。 Multiple Lateral View可以实现类似笛卡尔乘积。 Outer关键字可以把不输出的UDTF的空结果，输出成NULL，防止丢失数据。</p>
<h3 id="行转列"><a href="#行转列" class="headerlink" title="行转列"></a>行转列</h3><p>相关参数说明:</p>
<p>​	CONCAT(string A&#x2F;col, string B&#x2F;col…)：返回输入字符串连接后的结果，支持任意个输入字符串;</p>
<p>​	CONCAT_WS(separator, str1, str2,…)：它是一个特殊形式的 CONCAT()。第一个参数剩余参数间的分隔符。分隔符可以是与剩余参数一样的字符串。如果分隔符是 NULL，返回值也将为 NULL。这个函数会跳过分隔符参数后的任何 NULL 和空字符串。分隔符将被加到被连接的字符串之间;</p>
<p>​	COLLECT_SET(col)：函数只接受基本数据类型，它的主要作用是将某字段的值进行去重汇总，产生array类型字段。</p>
<p>数据准备:</p>
<table>
<thead>
<tr>
<th>name</th>
<th>constellation</th>
<th>blood_type</th>
</tr>
</thead>
<tbody><tr>
<td>孙悟空</td>
<td>白羊座</td>
<td>A</td>
</tr>
<tr>
<td>老王</td>
<td>射手座</td>
<td>A</td>
</tr>
<tr>
<td>宋宋</td>
<td>白羊座</td>
<td>B</td>
</tr>
<tr>
<td>猪八戒</td>
<td>白羊座</td>
<td>A</td>
</tr>
<tr>
<td>凤姐</td>
<td>射手座</td>
<td>A</td>
</tr>
</tbody></table>
<p>需求: 把星座和血型一样的人归类到一起。结果如下：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">射手座,A            老王<span class="operator">|</span>凤姐</span><br><span class="line">白羊座,A            孙悟空<span class="operator">|</span>猪八戒</span><br><span class="line">白羊座,B            宋宋</span><br></pre></td></tr></table></figure></div>

<p>实现步骤:</p>
<ul>
<li><ol>
<li>创建本地constellation.txt，导入数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">node03服务器执行以下命令创建文件，注意数据使用\t进行分割</span><br><span class="line">cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas</span><br><span class="line">vim constellation.txt</span><br><span class="line"></span><br><span class="line">数据如下: </span><br><span class="line">孙悟空	白羊座	A</span><br><span class="line">老王	射手座	A</span><br><span class="line">宋宋	白羊座	B       </span><br><span class="line">猪八戒	白羊座	A</span><br><span class="line">凤姐	射手座	A</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>创建hive表并导入数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">创建hive表并加载数据</span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> person_info(</span><br><span class="line">                    name string, </span><br><span class="line">                    constellation string, </span><br><span class="line">                    blood_type string) </span><br><span class="line">                    <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> &quot;\t&quot;;</span><br><span class="line">                    </span><br><span class="line">加载数据</span><br><span class="line">hive (hive_explode)<span class="operator">&gt;</span> load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/constellation.txt&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> person_info;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>按需求查询数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span></span><br><span class="line">                        t1.base,</span><br><span class="line">                        concat_ws(<span class="string">&#x27;|&#x27;</span>, collect_set(t1.name)) name</span><br><span class="line">                    <span class="keyword">from</span></span><br><span class="line">                        (<span class="keyword">select</span></span><br><span class="line">                            name,</span><br><span class="line">                            concat(constellation, &quot;,&quot; , blood_type) base</span><br><span class="line">                        <span class="keyword">from</span></span><br><span class="line">                            person_info) t1</span><br><span class="line">                    <span class="keyword">group</span> <span class="keyword">by</span></span><br><span class="line">                        t1.base;</span><br></pre></td></tr></table></figure></div>

<h3 id="列转行"><a href="#列转行" class="headerlink" title="列转行"></a>列转行</h3><p>所需函数:</p>
<p>​	EXPLODE(col)：将hive一列中复杂的array或者map结构拆分成多行。</p>
<p>​	LATERAL VIEW</p>
<p>​		用法：LATERAL VIEW udtf(expression) tableAlias AS columnAlias</p>
<p>​		解释：用于和split, explode等UDTF一起使用，它能够将一列数据拆成多行数据，在此基础上可以对拆分后的数据进行聚合。</p>
<p>数据准备:</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas</span><br><span class="line">vim movie.txt</span><br><span class="line">文件内容如下:  数据字段之间使用\t进行分割</span><br><span class="line">《疑犯追踪》	悬疑,动作,科幻,剧情</span><br><span class="line">《Lie <span class="keyword">to</span> me》	悬疑,警匪,动作,心理,剧情</span><br><span class="line">《战狼<span class="number">2</span>》	战争,动作,灾难</span><br></pre></td></tr></table></figure></div>

<p>需求: 将电影分类中的数组数据展开。结果如下：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">《疑犯追踪》	悬疑</span><br><span class="line">《疑犯追踪》	动作</span><br><span class="line">《疑犯追踪》	科幻</span><br><span class="line">《疑犯追踪》	剧情</span><br><span class="line">《Lie <span class="keyword">to</span> me》	悬疑</span><br><span class="line">《Lie <span class="keyword">to</span> me》	警匪</span><br><span class="line">《Lie <span class="keyword">to</span> me》	动作</span><br><span class="line">《Lie <span class="keyword">to</span> me》	心理</span><br><span class="line">《Lie <span class="keyword">to</span> me》	剧情</span><br><span class="line">《战狼<span class="number">2</span>》	战争</span><br><span class="line">《战狼<span class="number">2</span>》	动作</span><br><span class="line">《战狼<span class="number">2</span>》	灾难</span><br></pre></td></tr></table></figure></div>

<p>实现步骤:</p>
<ul>
<li><ol>
<li>创建hive表</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> movie_info(</span><br><span class="line">    movie string, </span><br><span class="line">    category <span class="keyword">array</span><span class="operator">&lt;</span>string<span class="operator">&gt;</span>) </span><br><span class="line"><span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> &quot;\t&quot;</span><br><span class="line">collection items terminated <span class="keyword">by</span> &quot;,&quot;;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">load data <span class="keyword">local</span> inpath &quot;/export/servers/hivedatas/movie.txt&quot; <span class="keyword">into</span> <span class="keyword">table</span> movie_info;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>按需求查询数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span></span><br><span class="line">    movie,</span><br><span class="line">    category_name</span><br><span class="line"><span class="keyword">from</span> </span><br><span class="line">    movie_info <span class="keyword">lateral</span> <span class="keyword">view</span> explode(category) table_tmp <span class="keyword">as</span> category_name;</span><br></pre></td></tr></table></figure></div>

<h3 id="reflect函数"><a href="#reflect函数" class="headerlink" title="reflect函数"></a>reflect函数</h3><p>​	reflect函数可以支持在sql中调用java中的自带函数，秒杀一切udf函数。</p>
<p>需求1: 使用java.lang.Math当中的Max求两列中最大值</p>
<p>实现步骤:</p>
<ul>
<li><ol>
<li>创建hive表</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_udf(col1 <span class="type">int</span>,col2 <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>准备数据并加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas</span><br><span class="line">vim test_udf </span><br><span class="line"></span><br><span class="line">文件内容如下:</span><br><span class="line"><span class="number">1</span>,<span class="number">2</span></span><br><span class="line"><span class="number">4</span>,<span class="number">3</span></span><br><span class="line"><span class="number">6</span>,<span class="number">4</span></span><br><span class="line"><span class="number">7</span>,<span class="number">5</span></span><br><span class="line"><span class="number">5</span>,<span class="number">6</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/test_udf&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> test_udf;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>使用java.lang.Math当中的Max求两列当中的最大值</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> reflect(&quot;java.lang.Math&quot;,&quot;max&quot;,col1,col2) <span class="keyword">from</span> test_udf;</span><br></pre></td></tr></table></figure></div>

<p>需求2: 文件中不同的记录来执行不同的java的内置函数</p>
<p>实现步骤:</p>
<ul>
<li><ol>
<li>创建hive表</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">create</span> <span class="keyword">table</span> test_udf2(class_name string,method_name string,col1 <span class="type">int</span> , col2 <span class="type">int</span>) <span class="type">row</span> format delimited fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>准备数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="operator">/</span>export<span class="operator">/</span>servers<span class="operator">/</span>hivedatas</span><br><span class="line">vim test_udf2</span><br><span class="line"></span><br><span class="line">文件内容如下:</span><br><span class="line">java.lang.Math,min,<span class="number">1</span>,<span class="number">2</span></span><br><span class="line">java.lang.Math,max,<span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>加载数据</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> load data <span class="keyword">local</span> inpath <span class="string">&#x27;/export/servers/hivedatas/test_udf2&#x27;</span> overwrite <span class="keyword">into</span> <span class="keyword">table</span> test_udf2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><ol>
<li>执行查询</li>
</ol>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hive (hive_explode)<span class="operator">&gt;</span> <span class="keyword">select</span> reflect(class_name,method_name,col1,col2) <span class="keyword">from</span> test_udf2;</span><br></pre></td></tr></table></figure></div>

<p>需求3: 判断是否为数字</p>
<p>实现方式:</p>
<p>​	使用apache commons中的函数，commons下的jar已经包含在hadoop的classpath中，所以可以直接使用。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> reflect(&quot;org.apache.commons.lang.math.NumberUtils&quot;,&quot;isNumber&quot;,&quot;123&quot;)</span><br></pre></td></tr></table></figure></div>

<h2 id="窗口函数与分析函数"><a href="#窗口函数与分析函数" class="headerlink" title="窗口函数与分析函数"></a>窗口函数与分析函数</h2><p>在sql中有一类函数叫做聚合函数,例如sum()、avg()、max()等等,这类函数可以将多行数据按照规则聚集为一行,一般来讲聚集后的行数是要少于聚集前的行数的。但是有时我们想要既显示聚集前的数据,又要显示聚集后的数据,这时我们便引入了窗口函数。窗口函数又叫OLAP函数&#x2F;分析函数，窗口函数兼具分组和排序功能。</p>
<p>窗口函数最重要的关键字是 <strong>partition by</strong> 和 <strong>order by。</strong></p>
<p>具体语法如下：<strong>over (partition by xxx order by xxx)</strong></p>
<h3 id="sum、avg、min、max"><a href="#sum、avg、min、max" class="headerlink" title="sum、avg、min、max"></a>sum、avg、min、max</h3><p>准备数据</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">建表语句:</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> test_t1(</span><br><span class="line">cookieid string,</span><br><span class="line">createtime string,   <span class="comment">--day </span></span><br><span class="line">pv <span class="type">int</span></span><br><span class="line">) <span class="type">row</span> format delimited </span><br><span class="line">fields terminated <span class="keyword">by</span> <span class="string">&#x27;,&#x27;</span>;</span><br><span class="line"></span><br><span class="line">加载数据：</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t1.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t1;</span><br><span class="line"></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-10</span>,<span class="number">1</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-11</span>,<span class="number">5</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-12</span>,<span class="number">7</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,<span class="number">3</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-14</span>,<span class="number">2</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-15</span>,<span class="number">4</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-16</span>,<span class="number">4</span></span><br><span class="line"></span><br><span class="line">开启智能本地模式</span><br><span class="line"><span class="keyword">SET</span> hive.exec.mode.local.auto<span class="operator">=</span><span class="literal">true</span>;</span><br></pre></td></tr></table></figure></div>

<p>SUM函数和窗口函数的配合使用：结果和ORDER BY相关,默认为升序。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid <span class="keyword">order</span> <span class="keyword">by</span> createtime) <span class="keyword">as</span> pv1 </span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid <span class="keyword">order</span> <span class="keyword">by</span> createtime <span class="keyword">rows</span> <span class="keyword">between</span> unbounded preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) <span class="keyword">as</span> pv2</span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid) <span class="keyword">as</span> pv3</span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid <span class="keyword">order</span> <span class="keyword">by</span> createtime <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">3</span> preceding <span class="keyword">and</span> <span class="keyword">current</span> <span class="type">row</span>) <span class="keyword">as</span> pv4</span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid <span class="keyword">order</span> <span class="keyword">by</span> createtime <span class="keyword">rows</span> <span class="keyword">between</span> <span class="number">3</span> preceding <span class="keyword">and</span> <span class="number">1</span> following) <span class="keyword">as</span> pv5</span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"><span class="keyword">select</span> cookieid,createtime,pv,</span><br><span class="line"><span class="built_in">sum</span>(pv) <span class="keyword">over</span>(<span class="keyword">partition</span> <span class="keyword">by</span> cookieid <span class="keyword">order</span> <span class="keyword">by</span> createtime <span class="keyword">rows</span> <span class="keyword">between</span> <span class="keyword">current</span> <span class="type">row</span> <span class="keyword">and</span> unbounded following) <span class="keyword">as</span> pv6</span><br><span class="line"><span class="keyword">from</span> test_t1;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pv1: 分组内从起点到当前行的pv累积，如，<span class="number">11</span>号的pv1<span class="operator">=</span><span class="number">10</span>号的pv<span class="operator">+</span><span class="number">11</span>号的pv, <span class="number">12</span>号<span class="operator">=</span><span class="number">10</span>号<span class="operator">+</span><span class="number">11</span>号<span class="operator">+</span><span class="number">12</span>号</span><br><span class="line">pv2: 同pv1</span><br><span class="line">pv3: 分组内(cookie1)所有的pv累加</span><br><span class="line">pv4: 分组内当前行<span class="operator">+</span>往前<span class="number">3</span>行，如，<span class="number">11</span>号<span class="operator">=</span><span class="number">10</span>号<span class="operator">+</span><span class="number">11</span>号， <span class="number">12</span>号<span class="operator">=</span><span class="number">10</span>号<span class="operator">+</span><span class="number">11</span>号<span class="operator">+</span><span class="number">12</span>号，</span><br><span class="line">	                       <span class="number">13</span>号<span class="operator">=</span><span class="number">10</span>号<span class="operator">+</span><span class="number">11</span>号<span class="operator">+</span><span class="number">12</span>号<span class="operator">+</span><span class="number">13</span>号， <span class="number">14</span>号<span class="operator">=</span><span class="number">11</span>号<span class="operator">+</span><span class="number">12</span>号<span class="operator">+</span><span class="number">13</span>号<span class="operator">+</span><span class="number">14</span>号</span><br><span class="line">pv5: 分组内当前行<span class="operator">+</span>往前<span class="number">3</span>行<span class="operator">+</span>往后<span class="number">1</span>行，如，<span class="number">14</span>号<span class="operator">=</span><span class="number">11</span>号<span class="operator">+</span><span class="number">12</span>号<span class="operator">+</span><span class="number">13</span>号<span class="operator">+</span><span class="number">14</span>号<span class="operator">+</span><span class="number">15</span>号<span class="operator">=</span><span class="number">5</span><span class="operator">+</span><span class="number">7</span><span class="operator">+</span><span class="number">3</span><span class="operator">+</span><span class="number">2</span><span class="operator">+</span><span class="number">4</span><span class="operator">=</span><span class="number">21</span></span><br><span class="line">pv6: 分组内当前行<span class="operator">+</span>往后所有行，如，<span class="number">13</span>号<span class="operator">=</span><span class="number">13</span>号<span class="operator">+</span><span class="number">14</span>号<span class="operator">+</span><span class="number">15</span>号<span class="operator">+</span><span class="number">16</span>号<span class="operator">=</span><span class="number">3</span><span class="operator">+</span><span class="number">2</span><span class="operator">+</span><span class="number">4</span><span class="operator">+</span><span class="number">4</span><span class="operator">=</span><span class="number">13</span>，</span><br><span class="line">							 <span class="number">14</span>号<span class="operator">=</span><span class="number">14</span>号<span class="operator">+</span><span class="number">15</span>号<span class="operator">+</span><span class="number">16</span>号<span class="operator">=</span><span class="number">2</span><span class="operator">+</span><span class="number">4</span><span class="operator">+</span><span class="number">4</span><span class="operator">=</span><span class="number">10</span></span><br></pre></td></tr></table></figure></div>

<p>​	如果不指定rows between,默认为从起点到当前行;</p>
<p>​	如果不指定order by，则将分组内所有值累加;</p>
<p>​	关键是理解rows between含义,也叫做window子句：</p>
<p>​		preceding：往前</p>
<p>​		following：往后</p>
<p>​		current row：当前行</p>
<p>​		unbounded：起点</p>
<p>​		unbounded preceding 表示从前面的起点</p>
<p>​		unbounded following：表示到后面的终点</p>
<p>​	AVG，MIN，MAX，和SUM用法一样。</p>
<h3 id="row-number、rank、dense-rank、ntile"><a href="#row-number、rank、dense-rank、ntile" class="headerlink" title="row_number、rank、dense_rank、ntile"></a>row_number、rank、dense_rank、ntile</h3><p>准备数据</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-10</span>,<span class="number">1</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-11</span>,<span class="number">5</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-12</span>,<span class="number">7</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,<span class="number">3</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-14</span>,<span class="number">2</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-15</span>,<span class="number">4</span></span><br><span class="line">cookie1,<span class="number">2020</span><span class="number">-04</span><span class="number">-16</span>,<span class="number">4</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-10</span>,<span class="number">2</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-11</span>,<span class="number">3</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-12</span>,<span class="number">5</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,<span class="number">6</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-14</span>,<span class="number">3</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-15</span>,<span class="number">9</span></span><br><span class="line">cookie2,<span class="number">2020</span><span class="number">-04</span><span class="number">-16</span>,<span class="number">7</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_t2 (</span><br><span class="line">cookieid string,</span><br><span class="line">createtime string,   <span class="comment">--day </span></span><br><span class="line">pv <span class="type">INT</span></span><br><span class="line">) <span class="type">ROW</span> FORMAT DELIMITED </span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line">  </span><br><span class="line">加载数据：</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t2.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>ROW_NUMBER()使用</p>
<p>ROW_NUMBER()从1开始，按照顺序，生成分组内记录的序列。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">cookieid,</span><br><span class="line">createtime,</span><br><span class="line">pv,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn </span><br><span class="line"><span class="keyword">FROM</span> test_t2;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>RANK 和 DENSE_RANK使用</p>
<p>RANK() 生成数据项在分组中的排名，排名相等会在名次中留下空位 。</p>
<p>DENSE_RANK()生成数据项在分组中的排名，排名相等会在名次中不会留下空位。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">cookieid,</span><br><span class="line">createtime,</span><br><span class="line">pv,</span><br><span class="line"><span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn1,</span><br><span class="line"><span class="built_in">DENSE_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">desc</span>) <span class="keyword">AS</span> rn2,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> pv <span class="keyword">DESC</span>) <span class="keyword">AS</span> rn3 </span><br><span class="line"><span class="keyword">FROM</span> test_t2 </span><br><span class="line"><span class="keyword">WHERE</span> cookieid <span class="operator">=</span> <span class="string">&#x27;cookie1&#x27;</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>NTILE</p>
<p>有时会有这样的需求:如果数据排序后分为三部分，业务人员只关心其中的一部分，如何将这中间的三分之一数据拿出来呢?NTILE函数即可以满足。</p>
<p>ntile可以看成是：把有序的数据集合平均分配到指定的数量（num）个桶中, 将桶号分配给每一行。如果不能平均分配，则优先分配较小编号的桶，并且各个桶中能放的行数最多相差1。</p>
<p>然后可以根据桶号，选取前或后 n分之几的数据。数据会完整展示出来，只是给相应的数据打标签；具体要取几分之几的数据，需要再嵌套一层根据标签取出。</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">cookieid,</span><br><span class="line">createtime,</span><br><span class="line">pv,</span><br><span class="line"><span class="built_in">NTILE</span>(<span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn1,</span><br><span class="line"><span class="built_in">NTILE</span>(<span class="number">3</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn2,</span><br><span class="line"><span class="built_in">NTILE</span>(<span class="number">4</span>) <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn3</span><br><span class="line"><span class="keyword">FROM</span> test_t2 </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cookieid,createtime;</span><br></pre></td></tr></table></figure></div>

<h2 id="其他一些窗口函数"><a href="#其他一些窗口函数" class="headerlink" title="其他一些窗口函数"></a>其他一些窗口函数</h2><h3 id="lag-lead-first-value-last-value"><a href="#lag-lead-first-value-last-value" class="headerlink" title="lag,lead,first_value,last_value"></a>lag,lead,first_value,last_value</h3><ul>
<li>LAG<br> <strong>LAG(col,n,DEFAULT) 用于统计窗口内往上第n行值</strong>第一个参数为列名，第二个参数为往上第n行（可选，默认为1），第三个参数为默认值（当往上第n行为NULL时候，取默认值，如不指定，则为NULL）</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line"><span class="built_in">LAG</span>(createtime,<span class="number">1</span>,<span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last_1_time,</span><br><span class="line"><span class="built_in">LAG</span>(createtime,<span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last_2_time </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">last_1_time: 指定了往上第<span class="number">1</span>行的值，<span class="keyword">default</span>为<span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>  </span><br><span class="line">             			 cookie1第一行，往上<span class="number">1</span>行为<span class="keyword">NULL</span>,因此取默认值 <span class="number">1970</span><span class="number">-01</span><span class="number">-01</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span></span><br><span class="line">             			 cookie1第三行，往上<span class="number">1</span>行值为第二行值，<span class="number">2015</span><span class="number">-04</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">02</span></span><br><span class="line">             			 cookie1第六行，往上<span class="number">1</span>行值为第五行值，<span class="number">2015</span><span class="number">-04</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">01</span></span><br><span class="line">last_2_time: 指定了往上第<span class="number">2</span>行的值，为指定默认值</span><br><span class="line">  						 cookie1第一行，往上<span class="number">2</span>行为<span class="keyword">NULL</span></span><br><span class="line">  						 cookie1第二行，往上<span class="number">2</span>行为<span class="keyword">NULL</span></span><br><span class="line">  						 cookie1第四行，往上<span class="number">2</span>行为第二行值，<span class="number">2015</span><span class="number">-04</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">00</span>:<span class="number">02</span></span><br><span class="line">  						 cookie1第七行，往上<span class="number">2</span>行为第五行值，<span class="number">2015</span><span class="number">-04</span><span class="number">-10</span> <span class="number">10</span>:<span class="number">50</span>:<span class="number">01</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li>LEAD</li>
</ul>
<p>与LAG相反 <strong>LEAD(col,n,DEFAULT) 用于统计窗口内往下第n行值</strong> 第一个参数为列名，第二个参数为往下第n行（可选，默认为1），第三个参数为默认值（当往下第n行为NULL时候，取默认值，如不指定，则为NULL）</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line"><span class="built_in">LEAD</span>(createtime,<span class="number">1</span>,<span class="string">&#x27;1970-01-01 00:00:00&#x27;</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> next_1_time,</span><br><span class="line"><span class="built_in">LEAD</span>(createtime,<span class="number">2</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> next_2_time </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>FIRST_VALUE</p>
<p>取分组内排序后，截止到当前行，第一个值</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line"><span class="built_in">FIRST_VALUE</span>(url) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> first1 </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>LAST_VALUE</li>
</ul>
<p>取分组内排序后，截止到当前行，最后一个值</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line"><span class="built_in">LAST_VALUE</span>(url) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last1 </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br></pre></td></tr></table></figure></div>

<p>如果想要取分组内排序后最后一个值，则需要变通一下：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> rn,</span><br><span class="line"><span class="built_in">LAST_VALUE</span>(url) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime) <span class="keyword">AS</span> last1,</span><br><span class="line"><span class="built_in">FIRST_VALUE</span>(url) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid <span class="keyword">ORDER</span> <span class="keyword">BY</span> createtime <span class="keyword">DESC</span>) <span class="keyword">AS</span> last2 </span><br><span class="line"><span class="keyword">FROM</span> test_t4 </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> cookieid,createtime;</span><br></pre></td></tr></table></figure></div>

<p><strong>特别注意order  by</strong></p>
<p>如果不指定ORDER BY，则进行排序混乱，会出现错误的结果</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> cookieid,</span><br><span class="line">createtime,</span><br><span class="line">url,</span><br><span class="line"><span class="built_in">FIRST_VALUE</span>(url) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> cookieid) <span class="keyword">AS</span> first2  </span><br><span class="line"><span class="keyword">FROM</span> test_t4;</span><br></pre></td></tr></table></figure></div>

<h3 id="cume-dist-percent-rank"><a href="#cume-dist-percent-rank" class="headerlink" title="cume_dist,percent_rank"></a>cume_dist,percent_rank</h3><p>这两个序列分析函数不是很常用，<strong>注意： 序列函数不支持WINDOW子句</strong></p>
<ul>
<li>数据准备</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">d1,user1,<span class="number">1000</span></span><br><span class="line">d1,user2,<span class="number">2000</span></span><br><span class="line">d1,user3,<span class="number">3000</span></span><br><span class="line">d2,user4,<span class="number">4000</span></span><br><span class="line">d2,user5,<span class="number">5000</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">EXTERNAL</span> <span class="keyword">TABLE</span> test_t3 (</span><br><span class="line">dept STRING,</span><br><span class="line">userid string,</span><br><span class="line">sal <span class="type">INT</span></span><br><span class="line">) <span class="type">ROW</span> FORMAT DELIMITED </span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line">加载数据：</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t3.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t3;</span><br></pre></td></tr></table></figure></div>

<hr>
<ul>
<li><p>CUME_DIST  和order byd的排序顺序有关系</p>
<p>CUME_DIST 小于等于当前值的行数&#x2F;分组内总行数  order 默认顺序 正序 升序 比如，统计小于等于当前薪水的人数，所占总人数的比例</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"> dept,</span><br><span class="line"> userid,</span><br><span class="line"> sal,</span><br><span class="line"> <span class="built_in">CUME_DIST</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn1,</span><br><span class="line"> <span class="built_in">CUME_DIST</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dept <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn2 </span><br><span class="line"> <span class="keyword">FROM</span> test_t3;</span><br><span class="line"> </span><br><span class="line"> rn1: 没有<span class="keyword">partition</span>,所有数据均为<span class="number">1</span>组，总行数为<span class="number">5</span>，</span><br><span class="line">      第一行：小于等于<span class="number">1000</span>的行数为<span class="number">1</span>，因此，<span class="number">1</span><span class="operator">/</span><span class="number">5</span><span class="operator">=</span><span class="number">0.2</span></span><br><span class="line">      第三行：小于等于<span class="number">3000</span>的行数为<span class="number">3</span>，因此，<span class="number">3</span><span class="operator">/</span><span class="number">5</span><span class="operator">=</span><span class="number">0.6</span></span><br><span class="line"> rn2: 按照部门分组，dpet<span class="operator">=</span>d1的行数为<span class="number">3</span>,</span><br><span class="line">      第二行：小于等于<span class="number">2000</span>的行数为<span class="number">2</span>，因此，<span class="number">2</span><span class="operator">/</span><span class="number">3</span><span class="operator">=</span><span class="number">0.6666666666666666</span></span><br></pre></td></tr></table></figure></div>

<ul>
<li><p>PERCENT_RANK</p>
<p>PERCENT_RANK 分组内当前行的RANK值-1&#x2F;分组内总行数-1</p>
<p>经调研 该函数显示现实意义不明朗 有待于继续考证</p>
</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line">  dept,</span><br><span class="line">  userid,</span><br><span class="line">  sal,</span><br><span class="line">  <span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn1,   <span class="comment">--分组内</span></span><br><span class="line">  <span class="built_in">RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn11,          <span class="comment">--分组内RANK值</span></span><br><span class="line">  <span class="built_in">SUM</span>(<span class="number">1</span>) <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">NULL</span>) <span class="keyword">AS</span> rn12,     <span class="comment">--分组内总行数</span></span><br><span class="line">  <span class="built_in">PERCENT_RANK</span>() <span class="keyword">OVER</span>(<span class="keyword">PARTITION</span> <span class="keyword">BY</span> dept <span class="keyword">ORDER</span> <span class="keyword">BY</span> sal) <span class="keyword">AS</span> rn2 </span><br><span class="line">  <span class="keyword">FROM</span> test_t3;</span><br><span class="line">  </span><br><span class="line">  rn1: rn1 <span class="operator">=</span> (rn11<span class="number">-1</span>) <span class="operator">/</span> (rn12<span class="number">-1</span>) </span><br><span class="line">  	   第一行,(<span class="number">1</span><span class="number">-1</span>)<span class="operator">/</span>(<span class="number">5</span><span class="number">-1</span>)<span class="operator">=</span><span class="number">0</span><span class="operator">/</span><span class="number">4</span><span class="operator">=</span><span class="number">0</span></span><br><span class="line">  	   第二行,(<span class="number">2</span><span class="number">-1</span>)<span class="operator">/</span>(<span class="number">5</span><span class="number">-1</span>)<span class="operator">=</span><span class="number">1</span><span class="operator">/</span><span class="number">4</span><span class="operator">=</span><span class="number">0.25</span></span><br><span class="line">  	   第四行,(<span class="number">4</span><span class="number">-1</span>)<span class="operator">/</span>(<span class="number">5</span><span class="number">-1</span>)<span class="operator">=</span><span class="number">3</span><span class="operator">/</span><span class="number">4</span><span class="operator">=</span><span class="number">0.75</span></span><br><span class="line">  rn2: 按照dept分组，</span><br><span class="line">       dept<span class="operator">=</span>d1的总行数为<span class="number">3</span></span><br><span class="line">       第一行，(<span class="number">1</span><span class="number">-1</span>)<span class="operator">/</span>(<span class="number">3</span><span class="number">-1</span>)<span class="operator">=</span><span class="number">0</span></span><br><span class="line">       第三行，(<span class="number">3</span><span class="number">-1</span>)<span class="operator">/</span>(<span class="number">3</span><span class="number">-1</span>)<span class="operator">=</span><span class="number">1</span></span><br></pre></td></tr></table></figure></div>

<h3 id="grouping-sets-grouping-id-cube-rollup"><a href="#grouping-sets-grouping-id-cube-rollup" class="headerlink" title="grouping sets,grouping__id,cube,rollup"></a>grouping sets,grouping__id,cube,rollup</h3><p>​	这几个分析函数通常用于OLAP中，不能累加，而且需要根据不同维度上钻和下钻的指标统计，比如，分小时、天、月的UV数。</p>
<ul>
<li>数据准备</li>
</ul>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2020</span><span class="number">-03</span>,<span class="number">2020</span><span class="number">-03</span><span class="number">-10</span>,cookie1</span><br><span class="line"><span class="number">2020</span><span class="number">-03</span>,<span class="number">2020</span><span class="number">-03</span><span class="number">-10</span>,cookie5</span><br><span class="line"><span class="number">2020</span><span class="number">-03</span>,<span class="number">2020</span><span class="number">-03</span><span class="number">-12</span>,cookie7</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-12</span>,cookie3</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,cookie2</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,cookie4</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-16</span>,cookie4</span><br><span class="line"><span class="number">2020</span><span class="number">-03</span>,<span class="number">2020</span><span class="number">-03</span><span class="number">-10</span>,cookie2</span><br><span class="line"><span class="number">2020</span><span class="number">-03</span>,<span class="number">2020</span><span class="number">-03</span><span class="number">-10</span>,cookie3</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-12</span>,cookie5</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-13</span>,cookie6</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-15</span>,cookie3</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-15</span>,cookie2</span><br><span class="line"><span class="number">2020</span><span class="number">-04</span>,<span class="number">2020</span><span class="number">-04</span><span class="number">-16</span>,cookie1</span><br><span class="line"> </span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> test_t5 (</span><br><span class="line"><span class="keyword">month</span> STRING,</span><br><span class="line"><span class="keyword">day</span> STRING, </span><br><span class="line">cookieid STRING </span><br><span class="line">) <span class="type">ROW</span> FORMAT DELIMITED </span><br><span class="line">FIELDS TERMINATED <span class="keyword">BY</span> <span class="string">&#x27;,&#x27;</span> </span><br><span class="line">stored <span class="keyword">as</span> textfile;</span><br><span class="line"></span><br><span class="line">加载数据：</span><br><span class="line">load data <span class="keyword">local</span> inpath <span class="string">&#x27;/root/hivedata/test_t5.dat&#x27;</span> <span class="keyword">into</span> <span class="keyword">table</span> test_t5;</span><br></pre></td></tr></table></figure></div>

<hr>
<ul>
<li>GROUPING SETS</li>
</ul>
<p>grouping sets是一种将多个group by 逻辑写在一个sql语句中的便利写法。</p>
<p>等价于将不同维度的GROUP BY结果集进行UNION ALL。</p>
<p><strong>GROUPING__ID</strong>，表示结果属于哪一个分组集合。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">month</span>,</span><br><span class="line"><span class="keyword">day</span>,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,</span><br><span class="line">GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span> </span><br><span class="line"><span class="keyword">GROUPING</span> SETS (<span class="keyword">month</span>,<span class="keyword">day</span>) </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">grouping_id表示这一组结果属于哪个分组集合，</span><br><span class="line">根据<span class="keyword">grouping</span> sets中的分组条件<span class="keyword">month</span>，<span class="keyword">day</span>，<span class="number">1</span>是代表<span class="keyword">month</span>，<span class="number">2</span>是代表<span class="keyword">day</span></span><br><span class="line"></span><br><span class="line">等价于 </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>,<span class="keyword">NULL</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> <span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span> <span class="keyword">as</span> <span class="keyword">month</span>,<span class="keyword">day</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span>;</span><br></pre></td></tr></table></figure></div>

<p>再如：</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">month</span>,</span><br><span class="line"><span class="keyword">day</span>,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,</span><br><span class="line">GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span> </span><br><span class="line"><span class="keyword">GROUPING</span> SETS (<span class="keyword">month</span>,<span class="keyword">day</span>,(<span class="keyword">month</span>,<span class="keyword">day</span>)) </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>,<span class="keyword">NULL</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span>,<span class="keyword">day</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>,<span class="keyword">day</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">3</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>CUBE</li>
</ul>
<p>根据GROUP BY的维度的所有组合进行聚合。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">month</span>,</span><br><span class="line"><span class="keyword">day</span>,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,</span><br><span class="line">GROUPING__ID </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span> </span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">CUBE</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line">等价于</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span>,<span class="keyword">NULL</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">0</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>,<span class="keyword">NULL</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">1</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span> </span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">NULL</span>,<span class="keyword">day</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">2</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span> </span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">month</span>,<span class="keyword">day</span>,<span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,<span class="number">3</span> <span class="keyword">AS</span> GROUPING__ID <span class="keyword">FROM</span> test_t5 <span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span>;</span><br></pre></td></tr></table></figure></div>

<ul>
<li>ROLLUP</li>
</ul>
<p>是CUBE的子集，以最左侧的维度为主，从该维度进行层级聚合。</p>
<div class="highlight-container" data-rel="Sql"><figure class="iseeu highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">比如，以<span class="keyword">month</span>维度进行层级聚合：</span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">month</span>,</span><br><span class="line"><span class="keyword">day</span>,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,</span><br><span class="line">GROUPING__ID  </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">month</span>,<span class="keyword">day</span></span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line"></span><br><span class="line"><span class="comment">--把month和day调换顺序，则以day维度进行层级聚合：</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="keyword">day</span>,</span><br><span class="line"><span class="keyword">month</span>,</span><br><span class="line"><span class="built_in">COUNT</span>(<span class="keyword">DISTINCT</span> cookieid) <span class="keyword">AS</span> uv,</span><br><span class="line">GROUPING__ID  </span><br><span class="line"><span class="keyword">FROM</span> test_t5 </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span>,<span class="keyword">month</span> </span><br><span class="line"><span class="keyword">WITH</span> <span class="keyword">ROLLUP</span> </span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> GROUPING__ID;</span><br><span class="line">（这里，根据天和月进行聚合，和根据天聚合结果一样，因为有父子关系，如果是其他维度组合的话，就会不一样）</span><br></pre></td></tr></table></figure></div>



<hr>
<h1 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h1><div class="highlight-container" data-rel="Plaintext"><figure class="iseeu highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">读书是易事、思索是难事、但两者缺一,便全无用处。</span><br></pre></td></tr></table></figure></div>


        </div>

        
            <div class="post-copyright-info w-full my-8 px-2 sm:px-6 md:px-8">
                <div class="article-copyright-info-container">
    <ul>
        <li><strong>標題:</strong> 再学HiveSQL-详解版笔记</li>
        <li><strong>作者:</strong> Mr.zh</li>
        <li><strong>撰寫于
                :</strong> 2024-06-06 16:24:44</li>
        
            <li>
                <strong>更新于
                    :</strong> 2024-06-06 16:42:28
            </li>
        
        <li>
            <strong>連結:</strong> https://github.com/zhyoulove/2024/06/06/再学HiveSQL-详解版笔记/
        </li>
        <li>
            <strong>
                版權宣告:
            </strong>
            

            
                本作品采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0">CC BY-NC-SA 4.0</a> 进行许可。
            
        </li>
    </ul>
</div>

            </div>
        

        
            <ul class="post-tags-box text-lg mt-1.5 flex-wrap justify-center flex md:hidden">
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%8A%80%E6%9C%AF/">#大数据技术</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/SQL/">#SQL</a>&nbsp;
                    </li>
                
                    <li class="tag-item mx-0.5">
                        <a href="/tags/Hive-SQL/">#Hive SQL</a>&nbsp;
                    </li>
                
            </ul>
        

        

        
            <div class="article-nav my-8 flex justify-between items-center px-2 sm:px-6 md:px-8">
                
                    <div class="article-prev border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="prev"
                        rel="prev"
                        href="/2024/06/13/%E4%B8%80%E6%96%87%E6%95%99%E4%BC%9A%E4%BD%A0%E5%86%99SQL%E5%A4%9A%E8%A1%A8%E6%9F%A5%E8%AF%A2%E8%AF%AD%E5%8F%A5/"
                        >
                            <span class="left arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-left"></i>
                            </span>
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">一文教会你写SQL多表查询语句</span>
                                <span class="post-nav-item">上一篇</span>
                            </span>
                        </a>
                    </div>
                
                
                    <div class="article-next border-border-color shadow-redefine-flat shadow-shadow-color-2 rounded-medium px-4 py-2 hover:shadow-redefine-flat-hover hover:shadow-shadow-color-2">
                        <a class="next"
                        rel="next"
                        href="/2024/06/04/DataX%E4%BD%BF%E7%94%A8%E5%9F%BA%E7%A1%80%E6%A1%88%E4%BE%8B/"
                        >
                            <span class="title flex justify-center items-center">
                                <span class="post-nav-title-item">DataX使用基础案例</span>
                                <span class="post-nav-item">下一篇</span>
                            </span>
                            <span class="right arrow-icon flex justify-center items-center">
                                <i class="fa-solid fa-chevron-right"></i>
                            </span>
                        </a>
                    </div>
                
            </div>
        


        
    </div>

    
        <div class="toc-content-container">
            <div class="post-toc-wrap">
    <div class="post-toc">
        <div class="toc-title">此頁目錄</div>
        <div class="page-title">再学HiveSQL-详解版笔记</div>
        <ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Hive-Sql-%E5%A4%A7%E5%85%A8"><span class="nav-text">Hive Sql 大全</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#hive%E7%9A%84DDL%E8%AF%AD%E6%B3%95"><span class="nav-text">hive的DDL语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E5%BA%93%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-text">对数据库的操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AF%B9%E6%95%B0%E6%8D%AE%E8%A1%A8%E7%9A%84%E6%93%8D%E4%BD%9C"><span class="nav-text">对数据表的操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hive%E7%9A%84DQL%E6%9F%A5%E8%AF%A2%E8%AF%AD%E6%B3%95"><span class="nav-text">hive的DQL查询语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E8%A1%A8%E6%9F%A5%E8%AF%A2"><span class="nav-text">单表查询</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Hive%E5%87%BD%E6%95%B0"><span class="nav-text">Hive函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%81%9A%E5%90%88%E5%87%BD%E6%95%B0"><span class="nav-text">聚合函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="nav-text">关系运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%AD%A6%E8%BF%90%E7%AE%97"><span class="nav-text">数学运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="nav-text">逻辑运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E5%80%BC%E8%BF%90%E7%AE%97"><span class="nav-text">数值运算</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9D%A1%E4%BB%B6%E5%87%BD%E6%95%B0"><span class="nav-text">条件函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%97%A5%E6%9C%9F%E5%87%BD%E6%95%B0"><span class="nav-text">日期函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0"><span class="nav-text">字符串函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E5%90%88%E7%B1%BB%E5%9E%8B%E6%9E%84%E5%BB%BA%E6%93%8D%E4%BD%9C"><span class="nav-text">复合类型构建操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E8%AE%BF%E9%97%AE%E6%93%8D%E4%BD%9C"><span class="nav-text">复杂类型访问操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%8D%E6%9D%82%E7%B1%BB%E5%9E%8B%E9%95%BF%E5%BA%A6%E7%BB%9F%E8%AE%A1%E5%87%BD%E6%95%B0"><span class="nav-text">复杂类型长度统计函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#hive%E5%BD%93%E4%B8%AD%E7%9A%84lateral-view-%E4%B8%8E-explode%E4%BB%A5%E5%8F%8Areflect%E5%92%8C%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">hive当中的lateral view 与 explode以及reflect和窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8explode%E5%87%BD%E6%95%B0%E5%B0%86hive%E8%A1%A8%E4%B8%AD%E7%9A%84Map%E5%92%8CArray%E5%AD%97%E6%AE%B5%E6%95%B0%E6%8D%AE%E8%BF%9B%E8%A1%8C%E6%8B%86%E5%88%86"><span class="nav-text">使用explode函数将hive表中的Map和Array字段数据进行拆分</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8explode%E6%8B%86%E5%88%86json%E5%AD%97%E7%AC%A6%E4%B8%B2"><span class="nav-text">使用explode拆分json字符串</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%85%8D%E5%90%88LATERAL-VIEW%E4%BD%BF%E7%94%A8"><span class="nav-text">配合LATERAL  VIEW使用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%8C%E8%BD%AC%E5%88%97"><span class="nav-text">行转列</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%88%97%E8%BD%AC%E8%A1%8C"><span class="nav-text">列转行</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#reflect%E5%87%BD%E6%95%B0"><span class="nav-text">reflect函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0%E4%B8%8E%E5%88%86%E6%9E%90%E5%87%BD%E6%95%B0"><span class="nav-text">窗口函数与分析函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#sum%E3%80%81avg%E3%80%81min%E3%80%81max"><span class="nav-text">sum、avg、min、max</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#row-number%E3%80%81rank%E3%80%81dense-rank%E3%80%81ntile"><span class="nav-text">row_number、rank、dense_rank、ntile</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E4%B8%80%E4%BA%9B%E7%AA%97%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-text">其他一些窗口函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#lag-lead-first-value-last-value"><span class="nav-text">lag,lead,first_value,last_value</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#cume-dist-percent-rank"><span class="nav-text">cume_dist,percent_rank</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#grouping-sets-grouping-id-cube-rollup"><span class="nav-text">grouping sets,grouping__id,cube,rollup</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%86%99%E5%9C%A8%E6%9C%80%E5%90%8E"><span class="nav-text">写在最后</span></a></li></ol>

    </div>
</div>
        </div>
    
</div>



                

            </div>

            

        </div>

        <div class="main-content-footer">
            <footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color">
    <div class="info-container py-3 text-center">
        
        <div class="text-center">
            &copy;
            
              <span>2022</span>
              -
            
            2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration: 0.5s; color: #f54545"></i>&nbsp;&nbsp;<a href="/">Mr.zh</a>
            
                
                <p class="post-count space-x-0.5">
                    <span>
                        共 24 篇文章
                    </span>
                    
                        <span>
                            共 68.5k 字
                        </span>
                    
                </p>
            
        </div>
        
            <script data-swup-reload-script src="https://cn.vercount.one/js"></script>
            <div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right">
                
                    <span id="busuanzi_container_site_uv" class="lg:!block">
                        <span class="text-sm">讀者</span>
                        <span id="busuanzi_value_site_uv"></span>
                    </span>
                
                
                    <span id="busuanzi_container_site_pv" class="lg:!block">
                        <span class="text-sm">閱覽</span>
                        <span id="busuanzi_value_site_pv"></span>
                    </span>
                
            </div>
        
        <div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left">
            <span class="lg:block text-sm"><?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 框架</span>
            <span class="text-sm lg:block">主題&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.6.1</a></span>
        </div>
        
        
            <div>
                博客已運行 <span class="odometer" id="runtime_days" ></span> 天 <span class="odometer" id="runtime_hours"></span> 小時 <span class="odometer" id="runtime_minutes"></span> 分鐘 <span class="odometer" id="runtime_seconds"></span> 秒
            </div>
        
        
            <script data-swup-reload-script>
                try {
                    function odometer_init() {
                    const elements = document.querySelectorAll('.odometer');
                    elements.forEach(el => {
                        new Odometer({
                            el,
                            format: '( ddd).dd',
                            duration: 200
                        });
                    });
                    }
                    odometer_init();
                } catch (error) {}
            </script>
        
        
        
    </div>  
</footer>
        </div>
    </div>

    
        <div class="post-tools">
            <div class="post-tools-container">
    <ul class="article-tools-list">
        <!-- TOC aside toggle -->
        
            <li class="right-bottom-tools page-aside-toggle">
                <i class="fa-regular fa-outdent"></i>
            </li>
        

        <!-- go comment -->
        
    </ul>
</div>

        </div>
    

    <div class="right-side-tools-container">
        <div class="side-tools-container">
    <ul class="hidden-tools-list">
        <li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-plus"></i>
        </li>

        <li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center">
            <i class="fa-regular fa-magnifying-glass-minus"></i>
        </li>

        <li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center">
            <i class="fa-regular fa-moon"></i>
        </li>

        <!-- rss -->
        

        

        <li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center">
            <i class="fa-regular fa-arrow-down"></i>
        </li>
    </ul>

    <ul class="visible-tools-list">
        <li class="right-bottom-tools toggle-tools-list flex justify-center items-center">
            <i class="fa-regular fa-cog fa-spin"></i>
        </li>
        
            <li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center">
                <i class="arrow-up fas fa-arrow-up"></i>
                <span class="percent"></span>
            </li>
        
        
    </ul>
</div>

    </div>

    <div class="image-viewer-container">
    <img src="">
</div>


    
        <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
          <span class="search-input-field-pre">
            <i class="fa-solid fa-keyboard"></i>
          </span>
            <div class="search-input-container">
                <input autocomplete="off"
                       autocorrect="off"
                       autocapitalize="off"
                       placeholder="搜尋..."
                       spellcheck="false"
                       type="search"
                       class="search-input"
                >
            </div>
            <span class="popup-btn-close">
                <i class="fa-solid fa-times"></i>
            </span>
        </div>
        <div id="search-result">
            <div id="no-result">
                <i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i>
            </div>
        </div>
    </div>
</div>

    

</main>


    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/Swup.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/SwupSlideTheme.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/SwupScriptsPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/SwupProgressPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/SwupScrollPlugin.min.js"></script><script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/SwupPreloadPlugin.min.js"></script>
<script>
    const swup = new Swup({
        plugins: [
            new SwupScriptsPlugin({
                optin: true,
            }),
            new SwupProgressPlugin(),
            new SwupScrollPlugin({
                offset: 80,
            }),
            new SwupSlideTheme({
                mainElement: ".main-content-body",
            }),
            new SwupPreloadPlugin(),
        ],
        containers: ["#swup"],
    });
</script>






<script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/imageViewer.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/utils.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/main.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/layouts/navbarShrink.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/scrollTopBottom.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/lightDarkSwitch.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/layouts/categoryList.js"></script>


    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/localSearch.js"></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/codeBlock.js"></script>



    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/layouts/lazyload.js"></script>



    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/runtime.js"></script>
    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/odometer.min.js"></script>
    <link rel="stylesheet" href="//evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/assets/odometer-theme-minimal.css">



  <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/Typed.min.js"></script>
  <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/plugins/typed.js"></script>





    <script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/minimasonry.min.js"></script>
    <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/plugins/masonry.js"></script>




<div class="post-scripts" data-swup-reload-script>
    
        <script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/tools/tocToggle.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/layouts/toc.js"></script><script type="module" src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/plugins/tabs.js"></script>
    
</div>


    <div id="aplayer"></div>
<script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/libs/APlayer.min.js"></script>
<script src="https://evan.beee.top/projects/hexo-theme-redefine@2.6.1/source/js/plugins/aplayer.js"></script>

</body>
</html>
